"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/uploadthing";
exports.ids = ["vendor-chunks/uploadthing"];
exports.modules = {

/***/ "(ssr)/./node_modules/uploadthing/client/index.js":
/*!**************************************************!*\
  !*** ./node_modules/uploadthing/client/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UploadAbortedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError),\n/* harmony export */   UploadPausedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError),\n/* harmony export */   genUploader: () => (/* binding */ genUploader),\n/* harmony export */   generateClientDropzoneAccept: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateClientDropzoneAccept),\n/* harmony export */   generateMimeTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateMimeTypes),\n/* harmony export */   generatePermittedFileTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generatePermittedFileTypes),\n/* harmony export */   isValidFileSize: () => (/* binding */ isValidFileSize),\n/* harmony export */   isValidFileType: () => (/* binding */ isValidFileType),\n/* harmony export */   version: () => (/* binding */ version)\n/* harmony export */ });\n/* harmony import */ var effect_Array__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/Array */ \"(ssr)/./node_modules/effect/dist/esm/Array.js\");\n/* harmony import */ var effect_Micro__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Micro */ \"(ssr)/./node_modules/effect/dist/esm/Micro.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @uploadthing/shared */ \"(ssr)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_Function__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! effect/Function */ \"(ssr)/./node_modules/effect/dist/esm/Function.js\");\n\n\n\n\n\n\nvar version$1 = \"7.4.4\";\n\nconst createDeferred = ()=>{\n    let resolve;\n    let reject;\n    const ac = new AbortController();\n    const promise = new Promise((res, rej)=>{\n        resolve = res;\n        reject = rej;\n    });\n    return {\n        promise,\n        ac,\n        resolve,\n        reject\n    };\n};\n\nconst createAPIRequestUrl = (config)=>{\n    const url = new URL(config.url);\n    const queryParams = new URLSearchParams(url.search);\n    queryParams.set(\"actionType\", config.actionType);\n    queryParams.set(\"slug\", config.slug);\n    url.search = queryParams.toString();\n    return url;\n};\n/**\n * Creates a \"client\" for reporting events to the UploadThing server via the user's API endpoint.\n * Events are handled in \"./handler.ts starting at L112\"\n */ const createUTReporter = (cfg)=>(type, payload)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.gen(function*() {\n            const url = createAPIRequestUrl({\n                url: cfg.url,\n                slug: cfg.endpoint,\n                actionType: type\n            });\n            const headers = new Headers((yield* effect_Micro__WEBPACK_IMPORTED_MODULE_1__.promise(async ()=>typeof cfg.headers === \"function\" ? await cfg.headers() : cfg.headers)));\n            headers.set(\"x-uploadthing-package\", cfg.package);\n            headers.set(\"x-uploadthing-version\", version$1);\n            headers.set(\"Content-Type\", \"application/json\");\n            const response = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(url, {\n                method: \"POST\",\n                body: JSON.stringify(payload),\n                headers\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), /**\n         * We don't _need_ to validate the response here, just cast it for now.\n         * As of now, @effect/schema includes quite a few bytes we cut out by this...\n         * We have \"strong typing\" on the backend that ensures the shape should match.\n         */ effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"FetchError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: `Failed to report event \"${type}\" to UploadThing server`,\n                    cause: e\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"BadRequestError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getErrorTypeFromStatusCode)(e.status),\n                    message: e.getMessage(),\n                    cause: e.json\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"InvalidJson\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: \"Failed to parse response from UploadThing server\",\n                    cause: e\n                }))));\n            return response;\n        });\n\nconst uploadWithProgress = (file, rangeStart, presigned, onUploadProgress)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.async((resume)=>{\n        const xhr = new XMLHttpRequest();\n        xhr.open(\"PUT\", presigned.url, true);\n        xhr.setRequestHeader(\"Range\", `bytes=${rangeStart}-`);\n        xhr.setRequestHeader(\"x-uploadthing-version\", version$1);\n        xhr.responseType = \"json\";\n        let previousLoaded = 0;\n        xhr.upload.addEventListener(\"progress\", ({ loaded })=>{\n            const delta = loaded - previousLoaded;\n            onUploadProgress?.({\n                loaded,\n                delta\n            });\n            previousLoaded = loaded;\n        });\n        xhr.addEventListener(\"load\", ()=>{\n            resume(xhr.status >= 200 && xhr.status < 300 ? effect_Micro__WEBPACK_IMPORTED_MODULE_1__.succeed(xhr.response) : effect_Micro__WEBPACK_IMPORTED_MODULE_1__.die(`XHR failed ${xhr.status} ${xhr.statusText} - ${JSON.stringify(xhr.response)}`));\n        });\n        // Is there a case when the client would throw and\n        // ingest server not knowing about it? idts?\n        xhr.addEventListener(\"error\", ()=>{\n            resume(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"UPLOAD_FAILED\"\n            }));\n        });\n        const formData = new FormData();\n        formData.append(\"file\", rangeStart > 0 ? file.slice(rangeStart) : file);\n        xhr.send(formData);\n        return effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>xhr.abort());\n    });\nconst uploadFile = (file, presigned, opts)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(presigned.url, {\n        method: \"HEAD\"\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(({ headers })=>parseInt(headers.get(\"x-ut-range-start\") ?? \"0\", 10)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.tap((start)=>opts.onUploadProgress?.({\n            delta: start,\n            loaded: start\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((start)=>uploadWithProgress(file, start, presigned, (progressEvent)=>opts.onUploadProgress?.({\n                delta: progressEvent.delta,\n                loaded: progressEvent.loaded + start\n            }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((uploadResponse)=>({\n            name: file.name,\n            size: file.size,\n            key: presigned.key,\n            lastModified: file.lastModified,\n            serverData: uploadResponse.serverData,\n            url: uploadResponse.url,\n            appUrl: uploadResponse.appUrl,\n            customId: presigned.customId,\n            type: file.type,\n            fileHash: uploadResponse.fileHash\n        })));\nconst uploadFilesInternal = (endpoint, opts)=>{\n    // classic service right here\n    const reportEventToUT = createUTReporter({\n        endpoint: String(endpoint),\n        package: opts.package,\n        url: opts.url,\n        headers: opts.headers\n    });\n    const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n    let totalLoaded = 0;\n    return reportEventToUT(\"upload\", {\n        input: \"input\" in opts ? opts.input : null,\n        files: opts.files.map((f)=>({\n                name: f.name,\n                size: f.size,\n                type: f.type,\n                lastModified: f.lastModified\n            }))\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((presigneds)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.forEach(presigneds, (presigned, i)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>opts.onUploadBegin?.({\n                    file: opts.files[i].name\n                })), ()=>uploadFile(opts.files[i], presigned, {\n                    onUploadProgress: (ev)=>{\n                        totalLoaded += ev.delta;\n                        opts.onUploadProgress?.({\n                            file: opts.files[i],\n                            progress: Math.round(ev.loaded / opts.files[i].size * 100),\n                            loaded: ev.loaded,\n                            delta: ev.delta,\n                            totalLoaded,\n                            totalProgress: Math.round(totalLoaded / totalSize * 100)\n                        });\n                    }\n                })), {\n            concurrency: 6\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n};\n\nconst version = version$1;\n/**\n * Validate that a file is of a valid type given a route config\n * @public\n */ const isValidFileType = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((type)=>file.type.includes(type)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Validate that a file is of a valid size given a route config\n * @public\n */ const isValidFileSize = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((type)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fileSizeToBytes)(routeConfig[type].maxFileSize)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((maxFileSize)=>file.size <= maxFileSize), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Generate a typed uploader for a given FileRouter\n * @public\n */ const genUploader = (initOpts)=>{\n    const routeRegistry = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.createIdentityProxy)();\n    const controllableUpload = async (slug, opts)=>{\n        const uploads = new Map();\n        const endpoint = typeof slug === \"function\" ? slug(routeRegistry) : slug;\n        const utReporter = createUTReporter({\n            endpoint: String(endpoint),\n            package: initOpts.package,\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            headers: opts.headers\n        });\n        const presigneds = await effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromise(utReporter(\"upload\", {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            input: \"input\" in opts ? opts.input : null,\n            files: opts.files.map((f)=>({\n                    name: f.name,\n                    size: f.size,\n                    type: f.type,\n                    lastModified: f.lastModified\n                }))\n        }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch)));\n        const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n        let totalLoaded = 0;\n        const uploadEffect = (file, presigned)=>uploadFile(file, presigned, {\n                onUploadProgress: (progressEvent)=>{\n                    totalLoaded += progressEvent.delta;\n                    opts.onUploadProgress?.({\n                        ...progressEvent,\n                        file,\n                        progress: Math.round(progressEvent.loaded / file.size * 100),\n                        totalLoaded,\n                        totalProgress: Math.round(totalLoaded / totalSize * 100)\n                    });\n                }\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n        for (const [i, p] of presigneds.entries()){\n            const file = opts.files[i];\n            const deferred = createDeferred();\n            uploads.set(file, {\n                deferred,\n                presigned: p\n            });\n            void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, p), {\n                signal: deferred.ac.signal\n            }).then((result)=>{\n                if (result._tag === \"Success\") {\n                    return deferred.resolve(result.value);\n                } else if (result.cause._tag === \"Interrupt\") {\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                }\n                throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.cause);\n            }).catch((err)=>{\n                if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                deferred.reject(err);\n            });\n        }\n        /**\n     * Pause an ongoing upload\n     * @param file The file upload you want to pause. Can be omitted to pause all files\n     */ const pauseUpload = (file)=>{\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) return;\n                if (upload.deferred.ac.signal.aborted) {\n                    // Cancel the upload if it's already been paused\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n                }\n                upload.deferred.ac.abort();\n            }\n        };\n        /**\n     * Resume a paused upload\n     * @param file The file upload you want to resume. Can be omitted to resume all files\n     */ const resumeUpload = (file)=>{\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                upload.deferred.ac = new AbortController();\n                void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, upload.presigned), {\n                    signal: upload.deferred.ac.signal\n                }).then((result)=>{\n                    if (result._tag === \"Success\") {\n                        return upload.deferred.resolve(result.value);\n                    } else if (result.cause._tag === \"Interrupt\") {\n                        throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                    }\n                    throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.cause);\n                }).catch((err)=>{\n                    if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                    upload.deferred.reject(err);\n                });\n            }\n        };\n        /**\n     * Wait for an upload to complete\n     * @param file The file upload you want to wait for. Can be omitted to wait for all files\n     */ const done = async (file)=>{\n            const promises = [];\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                promises.push(upload.deferred.promise);\n            }\n            const results = await Promise.all(promises);\n            return file ? results[0] : results;\n        };\n        return {\n            pauseUpload,\n            resumeUpload,\n            done\n        };\n    };\n    /**\n   * One step upload function that both requests presigned URLs\n   * and then uploads the files to UploadThing\n   */ const typedUploadFiles = (slug, opts)=>{\n        const endpoint = typeof slug === \"function\" ? slug(routeRegistry) : slug;\n        return uploadFilesInternal(endpoint, {\n            ...opts,\n            skipPolling: {},\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            package: initOpts.package,\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            input: opts.input\n        }).pipe((effect)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(effect, opts.signal && {\n                signal: opts.signal\n            })).then((exit)=>{\n            if (exit._tag === \"Success\") {\n                return exit.value;\n            } else if (exit.cause._tag === \"Interrupt\") {\n                throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n            }\n            throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(exit.cause);\n        });\n    };\n    return {\n        uploadFiles: typedUploadFiles,\n        createUpload: controllableUpload,\n        /**\n     * Identity object that can be used instead of raw strings\n     * that allows \"Go to definition\" in your IDE to bring you\n     * to the backend definition of a route.\n     */ routeRegistry\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBb0M7QUFDRTtBQUNvTjtBQUNqRztBQUMxRzs7QUFFL0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCw2Q0FBUztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixnREFBZ0QsaURBQWE7QUFDN0Q7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDZEQUFRO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTyxpREFBYSxDQUFDLGtFQUFpQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZDQUFTLENBQUMseURBQVksR0FBRyxrREFBYyxvQkFBb0IsOENBQVUsS0FBSyxpRUFBZ0I7QUFDdEc7QUFDQSx3REFBd0QsS0FBSztBQUM3RDtBQUNBLGlCQUFpQixLQUFLLGtEQUFjLHlCQUF5Qiw4Q0FBVSxLQUFLLGlFQUFnQjtBQUM1RiwwQkFBMEIsK0VBQTBCO0FBQ3BEO0FBQ0E7QUFDQSxpQkFBaUIsS0FBSyxrREFBYyxxQkFBcUIsOENBQVUsS0FBSyxpRUFBZ0I7QUFDeEY7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUzs7QUFFVCw0RUFBNEUsK0NBQVc7QUFDdkY7QUFDQTtBQUNBLCtDQUErQyxXQUFXO0FBQzFEO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxRQUFRO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0EsMkRBQTJELGlEQUFhLGlCQUFpQiw2Q0FBUyxlQUFlLFlBQVksRUFBRSxnQkFBZ0IsSUFBSSw2QkFBNkI7QUFD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QTtBQUNBLDJCQUEyQjtBQUMzQixpQkFBaUIsdUVBQWtCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLFNBQVMsaUJBQWlCLHdEQUFvQjtBQUM5QztBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsY0FBYztBQUNkLDBCQUEwQixtRUFBa0I7QUFDNUM7QUFDQSxrQkFBa0IscURBQWlCO0FBQ25DLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVrRSIsInNvdXJjZXMiOlsiL1VzZXJzL2dhZ2VtY2NveS9Eb2N1bWVudHMvQ2hhdEdlbml1cy9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFyciBmcm9tICdlZmZlY3QvQXJyYXknO1xuaW1wb3J0ICogYXMgTWljcm8gZnJvbSAnZWZmZWN0L01pY3JvJztcbmltcG9ydCB7IGZldGNoRWZmLCBwYXJzZVJlc3BvbnNlSnNvbiwgVXBsb2FkVGhpbmdFcnJvciwgZ2V0RXJyb3JUeXBlRnJvbVN0YXR1c0NvZGUsIEZldGNoQ29udGV4dCwgbWF0Y2hGaWxlVHlwZSwgb2JqZWN0S2V5cywgZmlsZVNpemVUb0J5dGVzLCBjcmVhdGVJZGVudGl0eVByb3h5LCByZXNvbHZlTWF5YmVVcmxBcmcsIFVwbG9hZFBhdXNlZEVycm9yLCBVcGxvYWRBYm9ydGVkRXJyb3IgfSBmcm9tICdAdXBsb2FkdGhpbmcvc2hhcmVkJztcbmV4cG9ydCB7IFVwbG9hZEFib3J0ZWRFcnJvciwgVXBsb2FkUGF1c2VkRXJyb3IsIGdlbmVyYXRlQ2xpZW50RHJvcHpvbmVBY2NlcHQsIGdlbmVyYXRlTWltZVR5cGVzLCBnZW5lcmF0ZVBlcm1pdHRlZEZpbGVUeXBlcyB9IGZyb20gJ0B1cGxvYWR0aGluZy9zaGFyZWQnO1xuaW1wb3J0IHsgdW5zYWZlQ29lcmNlIH0gZnJvbSAnZWZmZWN0L0Z1bmN0aW9uJztcblxudmFyIHZlcnNpb24kMSA9IFwiNy40LjRcIjtcblxuY29uc3QgY3JlYXRlRGVmZXJyZWQgPSAoKT0+e1xuICAgIGxldCByZXNvbHZlO1xuICAgIGxldCByZWplY3Q7XG4gICAgY29uc3QgYWMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXMsIHJlaik9PntcbiAgICAgICAgcmVzb2x2ZSA9IHJlcztcbiAgICAgICAgcmVqZWN0ID0gcmVqO1xuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICAgIHByb21pc2UsXG4gICAgICAgIGFjLFxuICAgICAgICByZXNvbHZlLFxuICAgICAgICByZWplY3RcbiAgICB9O1xufTtcblxuY29uc3QgY3JlYXRlQVBJUmVxdWVzdFVybCA9IChjb25maWcpPT57XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChjb25maWcudXJsKTtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXModXJsLnNlYXJjaCk7XG4gICAgcXVlcnlQYXJhbXMuc2V0KFwiYWN0aW9uVHlwZVwiLCBjb25maWcuYWN0aW9uVHlwZSk7XG4gICAgcXVlcnlQYXJhbXMuc2V0KFwic2x1Z1wiLCBjb25maWcuc2x1Zyk7XG4gICAgdXJsLnNlYXJjaCA9IHF1ZXJ5UGFyYW1zLnRvU3RyaW5nKCk7XG4gICAgcmV0dXJuIHVybDtcbn07XG4vKipcbiAqIENyZWF0ZXMgYSBcImNsaWVudFwiIGZvciByZXBvcnRpbmcgZXZlbnRzIHRvIHRoZSBVcGxvYWRUaGluZyBzZXJ2ZXIgdmlhIHRoZSB1c2VyJ3MgQVBJIGVuZHBvaW50LlxuICogRXZlbnRzIGFyZSBoYW5kbGVkIGluIFwiLi9oYW5kbGVyLnRzIHN0YXJ0aW5nIGF0IEwxMTJcIlxuICovIGNvbnN0IGNyZWF0ZVVUUmVwb3J0ZXIgPSAoY2ZnKT0+KHR5cGUsIHBheWxvYWQpPT5NaWNyby5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gY3JlYXRlQVBJUmVxdWVzdFVybCh7XG4gICAgICAgICAgICAgICAgdXJsOiBjZmcudXJsLFxuICAgICAgICAgICAgICAgIHNsdWc6IGNmZy5lbmRwb2ludCxcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiB0eXBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygoeWllbGQqIE1pY3JvLnByb21pc2UoYXN5bmMgKCk9PnR5cGVvZiBjZmcuaGVhZGVycyA9PT0gXCJmdW5jdGlvblwiID8gYXdhaXQgY2ZnLmhlYWRlcnMoKSA6IGNmZy5oZWFkZXJzKSkpO1xuICAgICAgICAgICAgaGVhZGVycy5zZXQoXCJ4LXVwbG9hZHRoaW5nLXBhY2thZ2VcIiwgY2ZnLnBhY2thZ2UpO1xuICAgICAgICAgICAgaGVhZGVycy5zZXQoXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIiwgdmVyc2lvbiQxKTtcbiAgICAgICAgICAgIGhlYWRlcnMuc2V0KFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQqIGZldGNoRWZmKHVybCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksXG4gICAgICAgICAgICAgICAgaGVhZGVyc1xuICAgICAgICAgICAgfSkucGlwZShNaWNyby5hbmRUaGVuKHBhcnNlUmVzcG9uc2VKc29uKSwgLyoqXG4gICAgICAgICAqIFdlIGRvbid0IF9uZWVkXyB0byB2YWxpZGF0ZSB0aGUgcmVzcG9uc2UgaGVyZSwganVzdCBjYXN0IGl0IGZvciBub3cuXG4gICAgICAgICAqIEFzIG9mIG5vdywgQGVmZmVjdC9zY2hlbWEgaW5jbHVkZXMgcXVpdGUgYSBmZXcgYnl0ZXMgd2UgY3V0IG91dCBieSB0aGlzLi4uXG4gICAgICAgICAqIFdlIGhhdmUgXCJzdHJvbmcgdHlwaW5nXCIgb24gdGhlIGJhY2tlbmQgdGhhdCBlbnN1cmVzIHRoZSBzaGFwZSBzaG91bGQgbWF0Y2guXG4gICAgICAgICAqLyBNaWNyby5tYXAodW5zYWZlQ29lcmNlKSwgTWljcm8uY2F0Y2hUYWcoXCJGZXRjaEVycm9yXCIsIChlKT0+TWljcm8uZmFpbChuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfQ0xJRU5UX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gcmVwb3J0IGV2ZW50IFwiJHt0eXBlfVwiIHRvIFVwbG9hZFRoaW5nIHNlcnZlcmAsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlXG4gICAgICAgICAgICAgICAgfSkpKSwgTWljcm8uY2F0Y2hUYWcoXCJCYWRSZXF1ZXN0RXJyb3JcIiwgKGUpPT5NaWNyby5mYWlsKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogZ2V0RXJyb3JUeXBlRnJvbVN0YXR1c0NvZGUoZS5zdGF0dXMpLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlLmdldE1lc3NhZ2UoKSxcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGUuanNvblxuICAgICAgICAgICAgICAgIH0pKSksIE1pY3JvLmNhdGNoVGFnKFwiSW52YWxpZEpzb25cIiwgKGUpPT5NaWNyby5mYWlsKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9DTElFTlRfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcGFyc2UgcmVzcG9uc2UgZnJvbSBVcGxvYWRUaGluZyBzZXJ2ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVcbiAgICAgICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSk7XG5cbmNvbnN0IHVwbG9hZFdpdGhQcm9ncmVzcyA9IChmaWxlLCByYW5nZVN0YXJ0LCBwcmVzaWduZWQsIG9uVXBsb2FkUHJvZ3Jlc3MpPT5NaWNyby5hc3luYygocmVzdW1lKT0+e1xuICAgICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9wZW4oXCJQVVRcIiwgcHJlc2lnbmVkLnVybCwgdHJ1ZSk7XG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiUmFuZ2VcIiwgYGJ5dGVzPSR7cmFuZ2VTdGFydH0tYCk7XG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCIsIHZlcnNpb24kMSk7XG4gICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSBcImpzb25cIjtcbiAgICAgICAgbGV0IHByZXZpb3VzTG9hZGVkID0gMDtcbiAgICAgICAgeGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIiwgKHsgbG9hZGVkIH0pPT57XG4gICAgICAgICAgICBjb25zdCBkZWx0YSA9IGxvYWRlZCAtIHByZXZpb3VzTG9hZGVkO1xuICAgICAgICAgICAgb25VcGxvYWRQcm9ncmVzcz8uKHtcbiAgICAgICAgICAgICAgICBsb2FkZWQsXG4gICAgICAgICAgICAgICAgZGVsdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcHJldmlvdXNMb2FkZWQgPSBsb2FkZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCk9PntcbiAgICAgICAgICAgIHJlc3VtZSh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwID8gTWljcm8uc3VjY2VlZCh4aHIucmVzcG9uc2UpIDogTWljcm8uZGllKGBYSFIgZmFpbGVkICR7eGhyLnN0YXR1c30gJHt4aHIuc3RhdHVzVGV4dH0gLSAke0pTT04uc3RyaW5naWZ5KHhoci5yZXNwb25zZSl9YCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gSXMgdGhlcmUgYSBjYXNlIHdoZW4gdGhlIGNsaWVudCB3b3VsZCB0aHJvdyBhbmRcbiAgICAgICAgLy8gaW5nZXN0IHNlcnZlciBub3Qga25vd2luZyBhYm91dCBpdD8gaWR0cz9cbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCAoKT0+e1xuICAgICAgICAgICAgcmVzdW1lKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIlVQTE9BRF9GQUlMRURcIlxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCByYW5nZVN0YXJ0ID4gMCA/IGZpbGUuc2xpY2UocmFuZ2VTdGFydCkgOiBmaWxlKTtcbiAgICAgICAgeGhyLnNlbmQoZm9ybURhdGEpO1xuICAgICAgICByZXR1cm4gTWljcm8uc3luYygoKT0+eGhyLmFib3J0KCkpO1xuICAgIH0pO1xuY29uc3QgdXBsb2FkRmlsZSA9IChmaWxlLCBwcmVzaWduZWQsIG9wdHMpPT5mZXRjaEVmZihwcmVzaWduZWQudXJsLCB7XG4gICAgICAgIG1ldGhvZDogXCJIRUFEXCJcbiAgICB9KS5waXBlKE1pY3JvLm1hcCgoeyBoZWFkZXJzIH0pPT5wYXJzZUludChoZWFkZXJzLmdldChcIngtdXQtcmFuZ2Utc3RhcnRcIikgPz8gXCIwXCIsIDEwKSksIE1pY3JvLnRhcCgoc3RhcnQpPT5vcHRzLm9uVXBsb2FkUHJvZ3Jlc3M/Lih7XG4gICAgICAgICAgICBkZWx0YTogc3RhcnQsXG4gICAgICAgICAgICBsb2FkZWQ6IHN0YXJ0XG4gICAgICAgIH0pKSwgTWljcm8uZmxhdE1hcCgoc3RhcnQpPT51cGxvYWRXaXRoUHJvZ3Jlc3MoZmlsZSwgc3RhcnQsIHByZXNpZ25lZCwgKHByb2dyZXNzRXZlbnQpPT5vcHRzLm9uVXBsb2FkUHJvZ3Jlc3M/Lih7XG4gICAgICAgICAgICAgICAgZGVsdGE6IHByb2dyZXNzRXZlbnQuZGVsdGEsXG4gICAgICAgICAgICAgICAgbG9hZGVkOiBwcm9ncmVzc0V2ZW50LmxvYWRlZCArIHN0YXJ0XG4gICAgICAgICAgICB9KSkpLCBNaWNyby5tYXAodW5zYWZlQ29lcmNlKSwgTWljcm8ubWFwKCh1cGxvYWRSZXNwb25zZSk9Pih7XG4gICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICBzaXplOiBmaWxlLnNpemUsXG4gICAgICAgICAgICBrZXk6IHByZXNpZ25lZC5rZXksXG4gICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGZpbGUubGFzdE1vZGlmaWVkLFxuICAgICAgICAgICAgc2VydmVyRGF0YTogdXBsb2FkUmVzcG9uc2Uuc2VydmVyRGF0YSxcbiAgICAgICAgICAgIHVybDogdXBsb2FkUmVzcG9uc2UudXJsLFxuICAgICAgICAgICAgYXBwVXJsOiB1cGxvYWRSZXNwb25zZS5hcHBVcmwsXG4gICAgICAgICAgICBjdXN0b21JZDogcHJlc2lnbmVkLmN1c3RvbUlkLFxuICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlLFxuICAgICAgICAgICAgZmlsZUhhc2g6IHVwbG9hZFJlc3BvbnNlLmZpbGVIYXNoXG4gICAgICAgIH0pKSk7XG5jb25zdCB1cGxvYWRGaWxlc0ludGVybmFsID0gKGVuZHBvaW50LCBvcHRzKT0+e1xuICAgIC8vIGNsYXNzaWMgc2VydmljZSByaWdodCBoZXJlXG4gICAgY29uc3QgcmVwb3J0RXZlbnRUb1VUID0gY3JlYXRlVVRSZXBvcnRlcih7XG4gICAgICAgIGVuZHBvaW50OiBTdHJpbmcoZW5kcG9pbnQpLFxuICAgICAgICBwYWNrYWdlOiBvcHRzLnBhY2thZ2UsXG4gICAgICAgIHVybDogb3B0cy51cmwsXG4gICAgICAgIGhlYWRlcnM6IG9wdHMuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNvbnN0IHRvdGFsU2l6ZSA9IG9wdHMuZmlsZXMucmVkdWNlKChhY2MsIGYpPT5hY2MgKyBmLnNpemUsIDApO1xuICAgIGxldCB0b3RhbExvYWRlZCA9IDA7XG4gICAgcmV0dXJuIHJlcG9ydEV2ZW50VG9VVChcInVwbG9hZFwiLCB7XG4gICAgICAgIGlucHV0OiBcImlucHV0XCIgaW4gb3B0cyA/IG9wdHMuaW5wdXQgOiBudWxsLFxuICAgICAgICBmaWxlczogb3B0cy5maWxlcy5tYXAoKGYpPT4oe1xuICAgICAgICAgICAgICAgIG5hbWU6IGYubmFtZSxcbiAgICAgICAgICAgICAgICBzaXplOiBmLnNpemUsXG4gICAgICAgICAgICAgICAgdHlwZTogZi50eXBlLFxuICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZi5sYXN0TW9kaWZpZWRcbiAgICAgICAgICAgIH0pKVxuICAgIH0pLnBpcGUoTWljcm8uZmxhdE1hcCgocHJlc2lnbmVkcyk9Pk1pY3JvLmZvckVhY2gocHJlc2lnbmVkcywgKHByZXNpZ25lZCwgaSk9Pk1pY3JvLmZsYXRNYXAoTWljcm8uc3luYygoKT0+b3B0cy5vblVwbG9hZEJlZ2luPy4oe1xuICAgICAgICAgICAgICAgICAgICBmaWxlOiBvcHRzLmZpbGVzW2ldLm5hbWVcbiAgICAgICAgICAgICAgICB9KSksICgpPT51cGxvYWRGaWxlKG9wdHMuZmlsZXNbaV0sIHByZXNpZ25lZCwge1xuICAgICAgICAgICAgICAgICAgICBvblVwbG9hZFByb2dyZXNzOiAoZXYpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCArPSBldi5kZWx0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMub25VcGxvYWRQcm9ncmVzcz8uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBvcHRzLmZpbGVzW2ldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzOiBNYXRoLnJvdW5kKGV2LmxvYWRlZCAvIG9wdHMuZmlsZXNbaV0uc2l6ZSAqIDEwMCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiBldi5sb2FkZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGE6IGV2LmRlbHRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUHJvZ3Jlc3M6IE1hdGgucm91bmQodG90YWxMb2FkZWQgLyB0b3RhbFNpemUgKiAxMDApXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKSwge1xuICAgICAgICAgICAgY29uY3VycmVuY3k6IDZcbiAgICAgICAgfSkpLCBNaWNyby5wcm92aWRlU2VydmljZShGZXRjaENvbnRleHQsIHdpbmRvdy5mZXRjaCkpO1xufTtcblxuY29uc3QgdmVyc2lvbiA9IHZlcnNpb24kMTtcbi8qKlxuICogVmFsaWRhdGUgdGhhdCBhIGZpbGUgaXMgb2YgYSB2YWxpZCB0eXBlIGdpdmVuIGEgcm91dGUgY29uZmlnXG4gKiBAcHVibGljXG4gKi8gY29uc3QgaXNWYWxpZEZpbGVUeXBlID0gKGZpbGUsIHJvdXRlQ29uZmlnKT0+TWljcm8ucnVuU3luYyhtYXRjaEZpbGVUeXBlKGZpbGUsIG9iamVjdEtleXMocm91dGVDb25maWcpKS5waXBlKE1pY3JvLm1hcCgodHlwZSk9PmZpbGUudHlwZS5pbmNsdWRlcyh0eXBlKSksIE1pY3JvLm9yRWxzZVN1Y2NlZWQoKCk9PmZhbHNlKSkpO1xuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IGEgZmlsZSBpcyBvZiBhIHZhbGlkIHNpemUgZ2l2ZW4gYSByb3V0ZSBjb25maWdcbiAqIEBwdWJsaWNcbiAqLyBjb25zdCBpc1ZhbGlkRmlsZVNpemUgPSAoZmlsZSwgcm91dGVDb25maWcpPT5NaWNyby5ydW5TeW5jKG1hdGNoRmlsZVR5cGUoZmlsZSwgb2JqZWN0S2V5cyhyb3V0ZUNvbmZpZykpLnBpcGUoTWljcm8uZmxhdE1hcCgodHlwZSk9PmZpbGVTaXplVG9CeXRlcyhyb3V0ZUNvbmZpZ1t0eXBlXS5tYXhGaWxlU2l6ZSkpLCBNaWNyby5tYXAoKG1heEZpbGVTaXplKT0+ZmlsZS5zaXplIDw9IG1heEZpbGVTaXplKSwgTWljcm8ub3JFbHNlU3VjY2VlZCgoKT0+ZmFsc2UpKSk7XG4vKipcbiAqIEdlbmVyYXRlIGEgdHlwZWQgdXBsb2FkZXIgZm9yIGEgZ2l2ZW4gRmlsZVJvdXRlclxuICogQHB1YmxpY1xuICovIGNvbnN0IGdlblVwbG9hZGVyID0gKGluaXRPcHRzKT0+e1xuICAgIGNvbnN0IHJvdXRlUmVnaXN0cnkgPSBjcmVhdGVJZGVudGl0eVByb3h5KCk7XG4gICAgY29uc3QgY29udHJvbGxhYmxlVXBsb2FkID0gYXN5bmMgKHNsdWcsIG9wdHMpPT57XG4gICAgICAgIGNvbnN0IHVwbG9hZHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGNvbnN0IGVuZHBvaW50ID0gdHlwZW9mIHNsdWcgPT09IFwiZnVuY3Rpb25cIiA/IHNsdWcocm91dGVSZWdpc3RyeSkgOiBzbHVnO1xuICAgICAgICBjb25zdCB1dFJlcG9ydGVyID0gY3JlYXRlVVRSZXBvcnRlcih7XG4gICAgICAgICAgICBlbmRwb2ludDogU3RyaW5nKGVuZHBvaW50KSxcbiAgICAgICAgICAgIHBhY2thZ2U6IGluaXRPcHRzLnBhY2thZ2UsXG4gICAgICAgICAgICB1cmw6IHJlc29sdmVNYXliZVVybEFyZyhpbml0T3B0cz8udXJsKSxcbiAgICAgICAgICAgIGhlYWRlcnM6IG9wdHMuaGVhZGVyc1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcHJlc2lnbmVkcyA9IGF3YWl0IE1pY3JvLnJ1blByb21pc2UodXRSZXBvcnRlcihcInVwbG9hZFwiLCB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hc3NpZ25tZW50XG4gICAgICAgICAgICBpbnB1dDogXCJpbnB1dFwiIGluIG9wdHMgPyBvcHRzLmlucHV0IDogbnVsbCxcbiAgICAgICAgICAgIGZpbGVzOiBvcHRzLmZpbGVzLm1hcCgoZik9Pih7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGYubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogZi5zaXplLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBmLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZi5sYXN0TW9kaWZpZWRcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgfSkucGlwZShNaWNyby5wcm92aWRlU2VydmljZShGZXRjaENvbnRleHQsIHdpbmRvdy5mZXRjaCkpKTtcbiAgICAgICAgY29uc3QgdG90YWxTaXplID0gb3B0cy5maWxlcy5yZWR1Y2UoKGFjYywgZik9PmFjYyArIGYuc2l6ZSwgMCk7XG4gICAgICAgIGxldCB0b3RhbExvYWRlZCA9IDA7XG4gICAgICAgIGNvbnN0IHVwbG9hZEVmZmVjdCA9IChmaWxlLCBwcmVzaWduZWQpPT51cGxvYWRGaWxlKGZpbGUsIHByZXNpZ25lZCwge1xuICAgICAgICAgICAgICAgIG9uVXBsb2FkUHJvZ3Jlc3M6IChwcm9ncmVzc0V2ZW50KT0+e1xuICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCArPSBwcm9ncmVzc0V2ZW50LmRlbHRhO1xuICAgICAgICAgICAgICAgICAgICBvcHRzLm9uVXBsb2FkUHJvZ3Jlc3M/Lih7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5wcm9ncmVzc0V2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzOiBNYXRoLnJvdW5kKHByb2dyZXNzRXZlbnQubG9hZGVkIC8gZmlsZS5zaXplICogMTAwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQcm9ncmVzczogTWF0aC5yb3VuZCh0b3RhbExvYWRlZCAvIHRvdGFsU2l6ZSAqIDEwMClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkucGlwZShNaWNyby5wcm92aWRlU2VydmljZShGZXRjaENvbnRleHQsIHdpbmRvdy5mZXRjaCkpO1xuICAgICAgICBmb3IgKGNvbnN0IFtpLCBwXSBvZiBwcmVzaWduZWRzLmVudHJpZXMoKSl7XG4gICAgICAgICAgICBjb25zdCBmaWxlID0gb3B0cy5maWxlc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IGRlZmVycmVkID0gY3JlYXRlRGVmZXJyZWQoKTtcbiAgICAgICAgICAgIHVwbG9hZHMuc2V0KGZpbGUsIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZCxcbiAgICAgICAgICAgICAgICBwcmVzaWduZWQ6IHBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm9pZCBNaWNyby5ydW5Qcm9taXNlRXhpdCh1cGxvYWRFZmZlY3QoZmlsZSwgcCksIHtcbiAgICAgICAgICAgICAgICBzaWduYWw6IGRlZmVycmVkLmFjLnNpZ25hbFxuICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KT0+e1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuX3RhZyA9PT0gXCJTdWNjZXNzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzdWx0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5jYXVzZS5fdGFnID09PSBcIkludGVycnVwdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVcGxvYWRQYXVzZWRFcnJvcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aHJvdyBNaWNyby5jYXVzZVNxdWFzaChyZXN1bHQuY2F1c2UpO1xuICAgICAgICAgICAgfSkuY2F0Y2goKGVycik9PntcbiAgICAgICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgVXBsb2FkUGF1c2VkRXJyb3IpIHJldHVybjtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAqIFBhdXNlIGFuIG9uZ29pbmcgdXBsb2FkXG4gICAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdXBsb2FkIHlvdSB3YW50IHRvIHBhdXNlLiBDYW4gYmUgb21pdHRlZCB0byBwYXVzZSBhbGwgZmlsZXNcbiAgICAgKi8gY29uc3QgcGF1c2VVcGxvYWQgPSAoZmlsZSk9PntcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gQXJyLmVuc3VyZShmaWxlID8/IG9wdHMuZmlsZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWQgPSB1cGxvYWRzLmdldChmaWxlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh1cGxvYWQuZGVmZXJyZWQuYWMuc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSB1cGxvYWQgaWYgaXQncyBhbHJlYWR5IGJlZW4gcGF1c2VkXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVcGxvYWRBYm9ydGVkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXBsb2FkLmRlZmVycmVkLmFjLmFib3J0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAqIFJlc3VtZSBhIHBhdXNlZCB1cGxvYWRcbiAgICAgKiBAcGFyYW0gZmlsZSBUaGUgZmlsZSB1cGxvYWQgeW91IHdhbnQgdG8gcmVzdW1lLiBDYW4gYmUgb21pdHRlZCB0byByZXN1bWUgYWxsIGZpbGVzXG4gICAgICovIGNvbnN0IHJlc3VtZVVwbG9hZCA9IChmaWxlKT0+e1xuICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBBcnIuZW5zdXJlKGZpbGUgPz8gb3B0cy5maWxlcyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHVwbG9hZCA9IHVwbG9hZHMuZ2V0KGZpbGUpO1xuICAgICAgICAgICAgICAgIGlmICghdXBsb2FkKSB0aHJvdyBcIk5vIHVwbG9hZCBmb3VuZFwiO1xuICAgICAgICAgICAgICAgIHVwbG9hZC5kZWZlcnJlZC5hYyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgICAgICAgICB2b2lkIE1pY3JvLnJ1blByb21pc2VFeGl0KHVwbG9hZEVmZmVjdChmaWxlLCB1cGxvYWQucHJlc2lnbmVkKSwge1xuICAgICAgICAgICAgICAgICAgICBzaWduYWw6IHVwbG9hZC5kZWZlcnJlZC5hYy5zaWduYWxcbiAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpPT57XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuX3RhZyA9PT0gXCJTdWNjZXNzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGxvYWQuZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5jYXVzZS5fdGFnID09PSBcIkludGVycnVwdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkUGF1c2VkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBNaWNyby5jYXVzZVNxdWFzaChyZXN1bHQuY2F1c2UpO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpPT57XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBVcGxvYWRQYXVzZWRFcnJvcikgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQuZGVmZXJyZWQucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAqIFdhaXQgZm9yIGFuIHVwbG9hZCB0byBjb21wbGV0ZVxuICAgICAqIEBwYXJhbSBmaWxlIFRoZSBmaWxlIHVwbG9hZCB5b3Ugd2FudCB0byB3YWl0IGZvci4gQ2FuIGJlIG9taXR0ZWQgdG8gd2FpdCBmb3IgYWxsIGZpbGVzXG4gICAgICovIGNvbnN0IGRvbmUgPSBhc3luYyAoZmlsZSk9PntcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IEFyci5lbnN1cmUoZmlsZSA/PyBvcHRzLmZpbGVzKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcyl7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBsb2FkID0gdXBsb2Fkcy5nZXQoZmlsZSk7XG4gICAgICAgICAgICAgICAgaWYgKCF1cGxvYWQpIHRocm93IFwiTm8gdXBsb2FkIGZvdW5kXCI7XG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaCh1cGxvYWQuZGVmZXJyZWQucHJvbWlzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgICAgICAgcmV0dXJuIGZpbGUgPyByZXN1bHRzWzBdIDogcmVzdWx0cztcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdXNlVXBsb2FkLFxuICAgICAgICAgICAgcmVzdW1lVXBsb2FkLFxuICAgICAgICAgICAgZG9uZVxuICAgICAgICB9O1xuICAgIH07XG4gICAgLyoqXG4gICAqIE9uZSBzdGVwIHVwbG9hZCBmdW5jdGlvbiB0aGF0IGJvdGggcmVxdWVzdHMgcHJlc2lnbmVkIFVSTHNcbiAgICogYW5kIHRoZW4gdXBsb2FkcyB0aGUgZmlsZXMgdG8gVXBsb2FkVGhpbmdcbiAgICovIGNvbnN0IHR5cGVkVXBsb2FkRmlsZXMgPSAoc2x1Zywgb3B0cyk9PntcbiAgICAgICAgY29uc3QgZW5kcG9pbnQgPSB0eXBlb2Ygc2x1ZyA9PT0gXCJmdW5jdGlvblwiID8gc2x1Zyhyb3V0ZVJlZ2lzdHJ5KSA6IHNsdWc7XG4gICAgICAgIHJldHVybiB1cGxvYWRGaWxlc0ludGVybmFsKGVuZHBvaW50LCB7XG4gICAgICAgICAgICAuLi5vcHRzLFxuICAgICAgICAgICAgc2tpcFBvbGxpbmc6IHt9LFxuICAgICAgICAgICAgdXJsOiByZXNvbHZlTWF5YmVVcmxBcmcoaW5pdE9wdHM/LnVybCksXG4gICAgICAgICAgICBwYWNrYWdlOiBpbml0T3B0cy5wYWNrYWdlLFxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtbWVtYmVyLWFjY2Vzc1xuICAgICAgICAgICAgaW5wdXQ6IG9wdHMuaW5wdXRcbiAgICAgICAgfSkucGlwZSgoZWZmZWN0KT0+TWljcm8ucnVuUHJvbWlzZUV4aXQoZWZmZWN0LCBvcHRzLnNpZ25hbCAmJiB7XG4gICAgICAgICAgICAgICAgc2lnbmFsOiBvcHRzLnNpZ25hbFxuICAgICAgICAgICAgfSkpLnRoZW4oKGV4aXQpPT57XG4gICAgICAgICAgICBpZiAoZXhpdC5fdGFnID09PSBcIlN1Y2Nlc3NcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBleGl0LnZhbHVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleGl0LmNhdXNlLl90YWcgPT09IFwiSW50ZXJydXB0XCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkQWJvcnRlZEVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBNaWNyby5jYXVzZVNxdWFzaChleGl0LmNhdXNlKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICB1cGxvYWRGaWxlczogdHlwZWRVcGxvYWRGaWxlcyxcbiAgICAgICAgY3JlYXRlVXBsb2FkOiBjb250cm9sbGFibGVVcGxvYWQsXG4gICAgICAgIC8qKlxuICAgICAqIElkZW50aXR5IG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIGluc3RlYWQgb2YgcmF3IHN0cmluZ3NcbiAgICAgKiB0aGF0IGFsbG93cyBcIkdvIHRvIGRlZmluaXRpb25cIiBpbiB5b3VyIElERSB0byBicmluZyB5b3VcbiAgICAgKiB0byB0aGUgYmFja2VuZCBkZWZpbml0aW9uIG9mIGEgcm91dGUuXG4gICAgICovIHJvdXRlUmVnaXN0cnlcbiAgICB9O1xufTtcblxuZXhwb3J0IHsgZ2VuVXBsb2FkZXIsIGlzVmFsaWRGaWxlU2l6ZSwgaXNWYWxpZEZpbGVUeXBlLCB2ZXJzaW9uIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/uploadthing/client/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/internal/types.js":
/*!****************************************************!*\
  !*** ./node_modules/uploadthing/internal/types.js ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* binding */ UTFiles)\n/* harmony export */ });\n/**\n * Marker used to append a `customId` to the incoming file data in `.middleware()`\n * @example\n * ```ts\n * .middleware((opts) => {\n *   return {\n *     [UTFiles]: opts.files.map((file) => ({\n *       ...file,\n *       customId: generateId(),\n *     }))\n *   };\n * })\n * ```\n */ const UTFiles = Symbol(\"uploadthing-custom-id-symbol\");\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvaW50ZXJuYWwvdHlwZXMuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVtQiIsInNvdXJjZXMiOlsiL1VzZXJzL2dhZ2VtY2NveS9Eb2N1bWVudHMvQ2hhdEdlbml1cy9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvaW50ZXJuYWwvdHlwZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNYXJrZXIgdXNlZCB0byBhcHBlbmQgYSBgY3VzdG9tSWRgIHRvIHRoZSBpbmNvbWluZyBmaWxlIGRhdGEgaW4gYC5taWRkbGV3YXJlKClgXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIC5taWRkbGV3YXJlKChvcHRzKSA9PiB7XG4gKiAgIHJldHVybiB7XG4gKiAgICAgW1VURmlsZXNdOiBvcHRzLmZpbGVzLm1hcCgoZmlsZSkgPT4gKHtcbiAqICAgICAgIC4uLmZpbGUsXG4gKiAgICAgICBjdXN0b21JZDogZ2VuZXJhdGVJZCgpLFxuICogICAgIH0pKVxuICogICB9O1xuICogfSlcbiAqIGBgYFxuICovIGNvbnN0IFVURmlsZXMgPSBTeW1ib2woXCJ1cGxvYWR0aGluZy1jdXN0b20taWQtc3ltYm9sXCIpO1xuXG5leHBvcnQgeyBVVEZpbGVzIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/internal/types.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/next/index.js":
/*!************************************************!*\
  !*** ./node_modules/uploadthing/next/index.js ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* reexport safe */ _internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles),\n/* harmony export */   createRouteHandler: () => (/* binding */ createRouteHandler),\n/* harmony export */   createUploadthing: () => (/* binding */ createUploadthing)\n/* harmony export */ });\n/* harmony import */ var effect_Effect__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! effect/Effect */ \"(rsc)/./node_modules/effect/dist/esm/Effect.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/FetchHttpClient.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/Headers.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpApp.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpRouter.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClient.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpIncomingMessage.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpBody.js\");\n/* harmony import */ var effect_Config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! effect/Config */ \"(rsc)/./node_modules/effect/dist/esm/Config.js\");\n/* harmony import */ var effect_Context__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! effect/Context */ \"(rsc)/./node_modules/effect/dist/esm/Context.js\");\n/* harmony import */ var effect_Match__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! effect/Match */ \"(rsc)/./node_modules/effect/dist/esm/Match.js\");\n/* harmony import */ var effect_Redacted__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! effect/Redacted */ \"(rsc)/./node_modules/effect/dist/esm/Redacted.js\");\n/* harmony import */ var effect_Schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Schema */ \"(rsc)/./node_modules/effect/dist/esm/Schema.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @uploadthing/shared */ \"(rsc)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/ConfigProvider */ \"(rsc)/./node_modules/effect/dist/esm/ConfigProvider.js\");\n/* harmony import */ var effect_Stream__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! effect/Stream */ \"(rsc)/./node_modules/effect/dist/esm/Stream.js\");\n/* harmony import */ var effect_Layer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! effect/Layer */ \"(rsc)/./node_modules/effect/dist/esm/Layer.js\");\n/* harmony import */ var effect_Logger__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! effect/Logger */ \"(rsc)/./node_modules/effect/dist/esm/Logger.js\");\n/* harmony import */ var effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! effect/LogLevel */ \"(rsc)/./node_modules/effect/dist/esm/LogLevel.js\");\n/* harmony import */ var effect_Cause__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! effect/Cause */ \"(rsc)/./node_modules/effect/dist/esm/Cause.js\");\n/* harmony import */ var effect_Data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! effect/Data */ \"(rsc)/./node_modules/effect/dist/esm/Data.js\");\n/* harmony import */ var effect_Runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! effect/Runtime */ \"(rsc)/./node_modules/effect/dist/esm/Runtime.js\");\n/* harmony import */ var effect_FiberRef__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! effect/FiberRef */ \"(rsc)/./node_modules/effect/dist/esm/FiberRef.js\");\n/* harmony import */ var effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! effect/ManagedRuntime */ \"(rsc)/./node_modules/effect/dist/esm/ManagedRuntime.js\");\n/* harmony import */ var _internal_types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/types.js */ \"(rsc)/./node_modules/uploadthing/internal/types.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar version = \"7.4.4\";\n\neffect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidContentDispositions);\neffect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidACLs);\n/**\n * Valid options for the `?actionType` query param\n */ const ActionType = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"upload\");\n/**\n * Valid options for the `uploadthing-hook` header\n * for requests coming from UT server\n */ const UploadThingHook = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"callback\", \"error\");\n/**\n * =============================================================================\n * =========================== Configuration ===================================\n * =============================================================================\n */ const DecodeString = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.transform(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromSelf, effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String, {\n    decode: (data)=>new TextDecoder().decode(data),\n    encode: (data)=>new TextEncoder().encode(data)\n});\nconst ParsedToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n    apiKey: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Redacted(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.startsWith(\"sk_\"))),\n    appId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    regions: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NonEmptyArray(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    ingestHost: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n        default: ()=>\"ingest.uploadthing.com\"\n    }))\n});\nconst UploadThingToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromBase64.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(DecodeString), effect_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.parseJson(ParsedToken)));\n/**\n * =============================================================================\n * ======================== File Type Hierarchy ===============================\n * =============================================================================\n */ /**\n * Properties from the web File object, this is what the client sends when initiating an upload\n */ class FileUploadData extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"FileUploadData\")({\n    name: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    size: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Number,\n    type: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    lastModified: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Number.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional)\n}) {\n}\n/**\n * `.middleware()` can add a customId to the incoming file data\n */ class FileUploadDataWithCustomId extends FileUploadData.extend(\"FileUploadDataWithCustomId\")({\n    customId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String)\n}) {\n}\n/**\n * When files are uploaded, we get back\n * - a key\n * - a direct URL for the file\n * - an app-specific URL for the file (useful for scoping eg. for optimization allowed origins)\n * - the hash (md5-hex) of the uploaded file's contents\n */ class UploadedFileData extends FileUploadDataWithCustomId.extend(\"UploadedFileData\")({\n    key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    url: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    appUrl: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    fileHash: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\n/**\n * =============================================================================\n * ======================== Server Response Schemas ============================\n * =============================================================================\n */ class NewPresignedUrl extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"NewPresignedUrl\")({\n    url: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    customId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    name: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\nclass MetadataFetchStreamPart extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchStreamPart\")({\n    payload: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    signature: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    hook: UploadThingHook\n}) {\n}\nclass MetadataFetchResponse extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchResponse\")({\n    ok: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\nclass CallbackResultResponse extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"CallbackResultResponse\")({\n    ok: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\n/**\n * =============================================================================\n * ======================== Client Action Payloads ============================\n * =============================================================================\n */ class UploadActionPayload extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"UploadActionPayload\")({\n    files: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(FileUploadData),\n    input: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n}) {\n}\n\n/**\n * Merge in `import.meta.env` to the built-in `process.env` provider\n * Prefix keys with `UPLOADTHING_` so we can reference just the name.\n * @example\n * process.env.UPLOADTHING_TOKEN = \"foo\"\n * Config.string(\"token\"); // Config<\"foo\">\n */ const envProvider = effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromEnv().pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromMap(new Map(Object.entries((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.filterDefinedObjectValues)(// fuck this I give up. import.meta is a mistake, someone else can fix it\n     null ?? {}))), {\n        pathDelim: \"_\"\n    })), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.nested(\"uploadthing\"), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.constantCase);\n/**\n * Config provider that merges the options from the object\n * and environment variables prefixed with `UPLOADTHING_`.\n * @remarks Options take precedence over environment variables.\n */ const configProvider = (options)=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromJson(options ?? {}).pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>envProvider));\nconst IsDevelopment = effect_Config__WEBPACK_IMPORTED_MODULE_4__.boolean(\"isDev\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.orElse(()=>effect_Config__WEBPACK_IMPORTED_MODULE_4__.succeed(typeof process !== \"undefined\" ? \"development\" : undefined).pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((_)=>_ === \"development\"))), effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(false));\nconst UTToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Config(\"token\", UploadThingToken).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n    ConfigError: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n            code: e._op === \"InvalidData\" ? \"INVALID_SERVER_CONFIG\" : \"MISSING_ENV\",\n            message: e._op === \"InvalidData\" ? \"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.\" : \"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.\",\n            cause: e\n        })\n}));\neffect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"apiUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(\"https://api.uploadthing.com\"), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\nconst IngestUrl = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n    const { regions, ingestHost } = yield* UTToken;\n    const region = regions[0]; // Currently only support 1 region per app\n    return yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"ingestUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(`https://${region}.${ingestHost}`), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\n});\n\nfunction defaultErrorFormatter(error) {\n    return {\n        message: error.message\n    };\n}\nfunction formatError(error, router) {\n    const errorFormatter = router[Object.keys(router)[0]]?.errorFormatter ?? defaultErrorFormatter;\n    return errorFormatter(error);\n}\n\nconst handleJsonLineStream = (schema, onChunk)=>(stream)=>{\n        let buf = \"\";\n        return stream.pipe(effect_Stream__WEBPACK_IMPORTED_MODULE_6__.decodeText(), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect((chunk)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                buf += chunk;\n                // Scan buffer for newlines\n                const parts = buf.split(\"\\n\");\n                const validChunks = [];\n                for (const part of parts){\n                    try {\n                        // Attempt to parse chunk as JSON\n                        validChunks.push(JSON.parse(part));\n                        // Advance buffer if parsing succeeded\n                        buf = buf.slice(part.length + 1);\n                    } catch  {\n                    //\n                    }\n                }\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Received chunks\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"chunk\", chunk), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"parsedChunks\", validChunks), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"buf\", buf));\n                return validChunks;\n            })), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.decodeUnknown(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(schema))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((part)=>onChunk(part))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.runDrain, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleJsonLineStream\"));\n    };\n\nconst withMinimalLogLevel = effect_Config__WEBPACK_IMPORTED_MODULE_4__.logLevel(\"logLevel\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__.Info), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.andThen((level)=>effect_Logger__WEBPACK_IMPORTED_MODULE_8__.minimumLogLevel(level)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid log level\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", e))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"ConfigError\", (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n        code: \"INVALID_SERVER_CONFIG\",\n        message: \"Invalid server configuration\",\n        cause: e\n    })), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.unwrapEffect);\nconst LogFormat = effect_Config__WEBPACK_IMPORTED_MODULE_4__.literal(\"json\", \"logFmt\", \"structured\", \"pretty\")(\"logFormat\");\nconst withLogFormat = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n    const isDev = yield* IsDevelopment;\n    const logFormat = yield* LogFormat.pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(isDev ? \"pretty\" : \"json\"));\n    return effect_Logger__WEBPACK_IMPORTED_MODULE_8__[logFormat];\n}).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"ConfigError\", (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n        code: \"INVALID_SERVER_CONFIG\",\n        message: \"Invalid server configuration\",\n        cause: e\n    })), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.unwrapEffect);\nconst logHttpClientResponse = (message, opts)=>{\n    const mixin = opts?.mixin ?? \"json\";\n    const level = effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__.fromLiteral(opts?.level ?? \"Debug\");\n    return (response)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(mixin !== \"None\" ? response[mixin] : effect_Effect__WEBPACK_IMPORTED_MODULE_5__[\"void\"], ()=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWithLevel(level, `${message} (${response.status})`).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"response\", response)));\n};\nconst logHttpClientError = (message)=>(err)=>err._tag === \"ResponseError\" ? logHttpClientResponse(message, {\n            level: \"Error\"\n        })(err.response) : effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(message).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", err));\n\nclass ParserError extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.TaggedError(\"ParserError\") {\n    constructor(...args){\n        super(...args), this.message = \"Input validation failed. The original error with it's validation issues is in the error cause.\";\n    }\n}\nfunction getParseFn(parser) {\n    if (\"~standard\" in parser) {\n        /**\n     * Standard Schema\n     */ return async (value)=>{\n            const result = await parser[\"~standard\"].validate(value);\n            if (result.issues) {\n                throw new ParserError({\n                    cause: result.issues\n                });\n            }\n            return result.value;\n        };\n    }\n    if (\"parseAsync\" in parser && typeof parser.parseAsync === \"function\") {\n        /**\n     * Zod\n     * TODO (next major): Consider wrapping ZodError in ParserError\n     */ return parser.parseAsync;\n    }\n    if (effect_Schema__WEBPACK_IMPORTED_MODULE_1__.isSchema(parser)) {\n        /**\n     * Effect Schema\n     */ return (value)=>effect_Schema__WEBPACK_IMPORTED_MODULE_1__.decodeUnknownPromise(parser)(value).catch((error)=>{\n                throw new ParserError({\n                    cause: effect_Cause__WEBPACK_IMPORTED_MODULE_11__.squash(error[effect_Runtime__WEBPACK_IMPORTED_MODULE_12__.FiberFailureCauseId])\n                });\n            });\n    }\n    throw new Error(\"Invalid parser\");\n}\n\nclass FileSizeMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, max, actual){\n        const reason = `You uploaded a ${type} file that was ${(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.bytesToFileSize)(actual)}, but the limit for that type is ${max}`;\n        super({\n            reason\n        }), this._tag = \"FileSizeMismatch\", this.name = \"FileSizeMismatchError\";\n    }\n}\nclass FileCountMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, boundtype, bound, actual){\n        const reason = `You uploaded ${actual} file(s) of type '${type}', but the ${boundtype} for that type is ${bound}`;\n        super({\n            reason\n        }), this._tag = \"FileCountMismatch\", this.name = \"FileCountMismatchError\";\n    }\n}\n// Verify that the uploaded files doesn't violate the route config,\n// e.g. uploading more videos than allowed, or a file that is larger than allowed.\n// This is double-checked on infra side, but we want to fail early to avoid network latency.\nconst assertFilesMeetConfig = (files, routeConfig)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const counts = {};\n        for (const file of files){\n            const type = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(routeConfig));\n            counts[type] = (counts[type] ?? 0) + 1;\n            const sizeLimit = routeConfig[type]?.maxFileSize;\n            if (!sizeLimit) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(type, \"maxFileSize\");\n            }\n            const sizeLimitBytes = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fileSizeToBytes)(sizeLimit);\n            if (file.size > sizeLimitBytes) {\n                return yield* new FileSizeMismatch(type, sizeLimit, file.size);\n            }\n        }\n        for(const _key in counts){\n            const key = _key;\n            const config = routeConfig[key];\n            if (!config) return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(key);\n            const count = counts[key];\n            const min = config.minFileCount;\n            const max = config.maxFileCount;\n            if (min > max) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid config during file count - minFileCount > maxFileCount\",\n                    cause: `minFileCount must be less than maxFileCount for key ${key}. got: ${min} > ${max}`\n                });\n            }\n            if (count < min) {\n                return yield* new FileCountMismatch(key, \"minimum\", min, count);\n            }\n            if (count > max) {\n                return yield* new FileCountMismatch(key, \"maximum\", max, count);\n            }\n        }\n        return null;\n    });\nconst extractRouterConfig = (router)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(router), (slug)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(router[slug].routerConfig), (config)=>({\n                slug,\n                config\n            })));\n\nconst makeRuntime = (fetch, config)=>{\n    const fetchHttpClient = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.provideMerge(_effect_platform__WEBPACK_IMPORTED_MODULE_13__.layer, effect_Layer__WEBPACK_IMPORTED_MODULE_9__.succeed(_effect_platform__WEBPACK_IMPORTED_MODULE_13__.Fetch, fetch));\n    const withRedactedHeaders = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.effectDiscard(effect_FiberRef__WEBPACK_IMPORTED_MODULE_14__.update(_effect_platform__WEBPACK_IMPORTED_MODULE_15__.currentRedactedNames, (_)=>_.concat([\n            \"x-uploadthing-api-key\"\n        ])));\n    const layer = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.provide(effect_Layer__WEBPACK_IMPORTED_MODULE_9__.mergeAll(withLogFormat, withMinimalLogLevel, fetchHttpClient, withRedactedHeaders), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.setConfigProvider(configProvider(config)));\n    return effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_16__.make(layer);\n};\n\nclass AdapterArguments extends effect_Context__WEBPACK_IMPORTED_MODULE_17__.Tag(\"uploadthing/AdapterArguments\")() {\n}\nconst makeAdapterHandler = (makeAdapterArgs, toRequest, opts, beAdapter)=>{\n    const managed = makeRuntime(opts.config?.fetch, opts.config);\n    const handle = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runtime().then(_effect_platform__WEBPACK_IMPORTED_MODULE_18__.toWebHandlerRuntime));\n    const app = (...args)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runPromise(createRequestHandler(opts, beAdapter))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.provideServiceEffect(AdapterArguments, makeAdapterArgs(...args)));\n    return async (...args)=>{\n        const result = await handle.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(app(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(toRequest(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"requestHandler\"), managed.runPromise);\n        return result;\n    };\n};\nconst createRequestHandler = (opts, beAdapter)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const isDevelopment = yield* IsDevelopment;\n        const routerConfig = yield* extractRouterConfig(opts.router);\n        const handleDaemon = (()=>{\n            if (opts.config?.handleDaemonPromise) {\n                return opts.config.handleDaemonPromise;\n            }\n            return isDevelopment ? \"void\" : \"await\";\n        })();\n        if (isDevelopment && handleDaemon === \"await\") {\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"INVALID_SERVER_CONFIG\",\n                message: 'handleDaemonPromise: \"await\" is forbidden in development.'\n            });\n        }\n        const GET = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_19__.json(routerConfig);\n        });\n        const POST = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const { \"uploadthing-hook\": uploadthingHook, \"x-uploadthing-package\": fePackage, \"x-uploadthing-version\": clientVersion } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.schemaHeaders(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                \"uploadthing-hook\": UploadThingHook.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                \"x-uploadthing-package\": effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>\"unknown\"\n                })),\n                \"x-uploadthing-version\": effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>version\n                }))\n            }));\n            if (clientVersion !== version) {\n                const serverVersion = version;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWarning(\"Client version mismatch. Things may not work as expected, please sync your versions to ensure compatibility.\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs({\n                    clientVersion,\n                    serverVersion\n                }));\n            }\n            const { slug, actionType } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_21__.schemaParams(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                actionType: ActionType.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                slug: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n            }));\n            const uploadable = opts.router[slug];\n            if (!uploadable) {\n                const msg = `No file route found for slug ${slug}`;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"NOT_FOUND\",\n                    message: msg\n                });\n            }\n            const { body, fiber } = yield* effect_Match__WEBPACK_IMPORTED_MODULE_22__.value({\n                actionType,\n                uploadthingHook\n            }).pipe(effect_Match__WEBPACK_IMPORTED_MODULE_22__.when({\n                actionType: \"upload\",\n                uploadthingHook: undefined\n            }, ()=>handleUploadAction({\n                    uploadable,\n                    fePackage,\n                    beAdapter,\n                    slug\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_22__.when({\n                actionType: undefined,\n                uploadthingHook: \"callback\"\n            }, ()=>handleCallbackRequest({\n                    uploadable,\n                    fePackage,\n                    beAdapter\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_22__.when({\n                actionType: undefined,\n                uploadthingHook: \"error\"\n            }, ()=>handleErrorRequest({\n                    uploadable\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_22__.orElse(()=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n                    body: null,\n                    fiber: null\n                })));\n            if (fiber) {\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running fiber as daemon\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"handleDaemon\", handleDaemon));\n                if (handleDaemon === \"void\") ; else if (handleDaemon === \"await\") {\n                    yield* fiber.await;\n                } else if (typeof handleDaemon === \"function\") {\n                    handleDaemon(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.runPromise(fiber.await));\n                }\n            }\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Sending response\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"body\", body));\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_19__.json(body);\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            ParseError: (e)=>_effect_platform__WEBPACK_IMPORTED_MODULE_19__.json(formatError(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: e.message\n                }), opts.router), {\n                    status: 400\n                }),\n            UploadThingError: (e)=>// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                _effect_platform__WEBPACK_IMPORTED_MODULE_19__.json(formatError(e, opts.router), {\n                    status: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.getStatusCodeFromError)(e)\n                })\n        }));\n        const appendResponseHeaders = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(_effect_platform__WEBPACK_IMPORTED_MODULE_19__.setHeader(\"x-uploadthing-version\", version));\n        return _effect_platform__WEBPACK_IMPORTED_MODULE_21__.empty.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_21__.get(\"*\", GET), _effect_platform__WEBPACK_IMPORTED_MODULE_21__.post(\"*\", POST), _effect_platform__WEBPACK_IMPORTED_MODULE_21__.use(appendResponseHeaders));\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"createRequestHandler\"));\nconst handleErrorRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.schemaBodyJson(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            fileKey: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            error: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling error callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        const adapterArgs = yield* AdapterArguments;\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable.onUploadError({\n                    ...adapterArgs,\n                    error: new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"UPLOAD_FAILED\",\n                        message: `Upload failed for ${requestInput.fileKey}: ${requestInput.error}`\n                    }),\n                    fileKey: requestInput.fileKey\n                }),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run onUploadError\",\n                    cause: error\n                })\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Failed to run onUploadError. You probably shouldn't be throwing errors here.\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", error)))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleErrorRequest\"));\nconst handleCallbackRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable, fePackage, beAdapter } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.schemaBodyJson(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            status: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            file: UploadedFileData,\n            metadata: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Record({\n                key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n                value: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n            })\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        /**\n     * Run `.onUploadComplete` as a daemon to prevent the\n     * request from UT to potentially timeout.\n     */ const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const adapterArgs = yield* AdapterArguments;\n            const serverData = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n                try: async ()=>uploadable.onUploadComplete({\n                        ...adapterArgs,\n                        file: requestInput.file,\n                        metadata: requestInput.metadata\n                    }),\n                catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"INTERNAL_SERVER_ERROR\",\n                        message: \"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.\",\n                        cause: error\n                    })\n            });\n            const payload = {\n                fileKey: requestInput.file.key,\n                callbackData: serverData ?? null\n            };\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"'onUploadComplete' callback finished. Sending response to UploadThing:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"callbackData\", payload));\n            const baseUrl = yield* IngestUrl;\n            const httpClient = (yield* _effect_platform__WEBPACK_IMPORTED_MODULE_23__.HttpClient).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_23__.filterStatusOk);\n            yield* _effect_platform__WEBPACK_IMPORTED_MODULE_24__.post(`/callback-result`).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.prependUrl(baseUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_24__.setHeaders({\n                \"x-uploadthing-api-key\": effect_Redacted__WEBPACK_IMPORTED_MODULE_25__.value(apiKey),\n                \"x-uploadthing-version\": version,\n                \"x-uploadthing-be-adapter\": beAdapter,\n                \"x-uploadthing-fe-package\": fePackage\n            }), _effect_platform__WEBPACK_IMPORTED_MODULE_24__.bodyJson(payload), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(httpClient.execute), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError(logHttpClientError(\"Failed to register callback result\")), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_26__.schemaBodyJson(CallbackResultResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tap(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.log(\"Sent callback result to UploadThing\")), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped);\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleCallbackRequest\"));\nconst runRouteMiddleware = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { json: { files, input }, uploadable } = opts;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running middleware\");\n        const adapterArgs = yield* AdapterArguments;\n        const metadata = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable.middleware({\n                    ...adapterArgs,\n                    input,\n                    files\n                }),\n            catch: (error)=>error instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError ? error : new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run middleware\",\n                    cause: error\n                })\n        });\n        if (metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles] && metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length !== files.length) {\n            const msg = `Expected files override to have the same length as original files, got ${metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length} but expected ${files.length}`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Files override must have the same length as files\",\n                cause: msg\n            });\n        }\n        // Attach customIds from middleware to the files\n        const filesWithCustomIds = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(files, (file, idx)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const theirs = metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles]?.[idx];\n                if (theirs && theirs.size !== file.size) {\n                    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWarning(\"File size mismatch. Reverting to original size\");\n                }\n                return {\n                    name: theirs?.name ?? file.name,\n                    size: file.size,\n                    type: file.type,\n                    customId: theirs?.customId,\n                    lastModified: theirs?.lastModified ?? Date.now()\n                };\n            }));\n        return {\n            metadata,\n            filesWithCustomIds\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"runRouteMiddleware\"));\nconst handleUploadAction = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const httpClient = (yield* _effect_platform__WEBPACK_IMPORTED_MODULE_23__.HttpClient).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_23__.filterStatusOk);\n        const { uploadable, fePackage, beAdapter, slug } = opts;\n        const json = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.schemaBodyJson(UploadActionPayload);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling upload request\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", json));\n        // validate the input\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing user input\");\n        const parsedInput = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: ()=>getParseFn(uploadable.inputParser)(json.input),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: error\n                })\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Input parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"input\", parsedInput));\n        const { metadata, filesWithCustomIds } = yield* runRouteMiddleware({\n            json: {\n                input: parsedInput,\n                files: json.files\n            },\n            uploadable\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing route config\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routerConfig\", uploadable.routerConfig));\n        const parsedConfig = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(uploadable.routerConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"InvalidRouteConfig\", (err)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid route config\",\n                cause: err\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Route config parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routeConfig\", parsedConfig));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Validating files meet the config requirements\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"files\", json.files));\n        yield* assertFilesMeetConfig(json.files, parsedConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.mapError((e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: `Invalid config: ${e._tag}`,\n                cause: \"reason\" in e ? e.reason : e.message\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Files validated.\");\n        const fileUploadRequests = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(filesWithCustomIds, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(parsedConfig)), (type)=>({\n                    name: file.name,\n                    size: file.size,\n                    type: file.type || type,\n                    lastModified: file.lastModified,\n                    customId: file.customId,\n                    contentDisposition: parsedConfig[type]?.contentDisposition ?? \"inline\",\n                    acl: parsedConfig[type]?.acl\n                }))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            /** Shouldn't happen since config is validated above so just dying is fine I think */ InvalidFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e),\n            UnknownFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e)\n        }));\n        const routeOptions = uploadable.routeOptions;\n        const { apiKey, appId } = yield* UTToken;\n        const ingestUrl = yield* IngestUrl;\n        const isDev = yield* IsDevelopment;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Generating presigned URLs\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"fileUploadRequests\", fileUploadRequests), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"ingestUrl\", ingestUrl));\n        const presignedUrls = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(fileUploadRequests, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const key = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateKey)(file, appId, routeOptions.getFileHashParts);\n                const url = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateSignedURL)(`${ingestUrl}/${key}`, apiKey, {\n                    ttlInSeconds: routeOptions.presignedURLTTL,\n                    data: {\n                        \"x-ut-identifier\": appId,\n                        \"x-ut-file-name\": file.name,\n                        \"x-ut-file-size\": file.size,\n                        \"x-ut-file-type\": file.type,\n                        \"x-ut-slug\": slug,\n                        \"x-ut-custom-id\": file.customId,\n                        \"x-ut-content-disposition\": file.contentDisposition,\n                        \"x-ut-acl\": file.acl\n                    }\n                });\n                return {\n                    url,\n                    key\n                };\n            }), {\n            concurrency: \"unbounded\"\n        });\n        const serverReq = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.HttpServerRequest;\n        const requestUrl = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.toURL(serverReq);\n        const devHookRequest = yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"callbackUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(requestUrl.origin + requestUrl.pathname), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((url)=>_effect_platform__WEBPACK_IMPORTED_MODULE_24__.post(url).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.appendUrlParam(\"slug\", slug))));\n        const metadataRequest = _effect_platform__WEBPACK_IMPORTED_MODULE_24__.post(\"/route-metadata\").pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.prependUrl(ingestUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_24__.setHeaders({\n            \"x-uploadthing-api-key\": effect_Redacted__WEBPACK_IMPORTED_MODULE_25__.value(apiKey),\n            \"x-uploadthing-version\": version,\n            \"x-uploadthing-be-adapter\": beAdapter,\n            \"x-uploadthing-fe-package\": fePackage\n        }), _effect_platform__WEBPACK_IMPORTED_MODULE_24__.bodyJson({\n            fileKeys: presignedUrls.map(({ key })=>key),\n            metadata: metadata,\n            isDev,\n            callbackUrl: devHookRequest.url,\n            callbackSlug: slug,\n            awaitServerData: routeOptions.awaitServerData ?? true\n        }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(httpClient.execute));\n        // Send metadata to UT server (non blocking as a daemon)\n        // In dev, keep the stream open and simulate the callback requests as\n        // files complete uploading\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__[\"if\"](isDev, {\n            onTrue: ()=>metadataRequest.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                    onSuccess: logHttpClientResponse(\"Registered metadata\", {\n                        mixin: \"None\"\n                    }),\n                    onFailure: logHttpClientError(\"Failed to register metadata\")\n                }), _effect_platform__WEBPACK_IMPORTED_MODULE_27__.stream, handleJsonLineStream(MetadataFetchStreamPart, (chunk)=>devHookRequest.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.setHeaders({\n                        \"uploadthing-hook\": chunk.hook,\n                        \"x-uploadthing-signature\": chunk.signature\n                    }), _effect_platform__WEBPACK_IMPORTED_MODULE_24__.setBody(_effect_platform__WEBPACK_IMPORTED_MODULE_28__.text(chunk.payload, \"application/json\")), httpClient.execute, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                        onSuccess: logHttpClientResponse(\"Successfully forwarded callback request from dev stream\"),\n                        onFailure: logHttpClientError(\"Failed to forward callback request from dev stream\")\n                    }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(chunk), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.asVoid, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped))),\n            onFalse: ()=>metadataRequest.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                    onSuccess: logHttpClientResponse(\"Registered metadata\"),\n                    onFailure: logHttpClientError(\"Failed to register metadata\")\n                }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_26__.schemaBodyJson(MetadataFetchResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped)\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        const presigneds = presignedUrls.map((p, i)=>({\n                url: p.url,\n                key: p.key,\n                name: fileUploadRequests[i].name,\n                customId: fileUploadRequests[i].customId ?? null\n            }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logInfo(\"Sending presigned URLs to client\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"presignedUrls\", presigneds));\n        return {\n            body: presigneds,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleUploadAction\"));\n\nfunction internalCreateBuilder(initDef = {}) {\n    const _def = {\n        $types: {},\n        // Default router config\n        routerConfig: {\n            image: {\n                maxFileSize: \"4MB\"\n            }\n        },\n        routeOptions: {\n            awaitServerData: true\n        },\n        inputParser: {\n            parseAsync: ()=>Promise.resolve(undefined),\n            _input: undefined,\n            _output: undefined\n        },\n        middleware: ()=>({}),\n        onUploadError: ()=>{\n        // noop\n        },\n        onUploadComplete: ()=>undefined,\n        errorFormatter: initDef.errorFormatter ?? defaultErrorFormatter,\n        // Overload with properties passed in\n        ...initDef\n    };\n    return {\n        input (userParser) {\n            return internalCreateBuilder({\n                ..._def,\n                inputParser: userParser\n            });\n        },\n        middleware (userMiddleware) {\n            return internalCreateBuilder({\n                ..._def,\n                middleware: userMiddleware\n            });\n        },\n        onUploadComplete (userUploadComplete) {\n            return {\n                ..._def,\n                onUploadComplete: userUploadComplete\n            };\n        },\n        onUploadError (userOnUploadError) {\n            return internalCreateBuilder({\n                ..._def,\n                onUploadError: userOnUploadError\n            });\n        }\n    };\n}\nfunction createBuilder(opts) {\n    return (input, config)=>{\n        return internalCreateBuilder({\n            routerConfig: input,\n            routeOptions: config ?? {},\n            ...opts\n        });\n    };\n}\n\nconst createUploadthing = (opts)=>createBuilder(opts);\nconst createRouteHandler = (opts)=>{\n    const handler = makeAdapterHandler((req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n            req,\n            res: undefined,\n            event: undefined\n        }), (req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed(req), opts, \"nextjs-app\");\n    return {\n        POST: handler,\n        GET: handler\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvbmV4dC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF3QztBQUM2STtBQUM3STtBQUNFO0FBQ0o7QUFDTTtBQUNUO0FBQ3lRO0FBQ3BQO0FBQ2hCO0FBQ0Y7QUFDRTtBQUNJO0FBQ047QUFDRjtBQUNNO0FBQ0U7QUFDWTtBQUNUO0FBQ0E7O0FBRS9DOztBQUVBLGtEQUFTLElBQUkseUVBQXdCO0FBQ3JDLGtEQUFTLElBQUksMERBQVM7QUFDdEI7QUFDQTtBQUNBLHVCQUF1QixrREFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsa0RBQVM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsb0RBQVcsQ0FBQyw2REFBb0IsRUFBRSxpREFBUTtBQUNuRTtBQUNBO0FBQ0EsQ0FBQztBQUNELG9CQUFvQixpREFBUTtBQUM1QixZQUFZLG1EQUFVLENBQUMsaURBQVEsTUFBTSxxREFBWTtBQUNqRCxXQUFXLGlEQUFRO0FBQ25CLGFBQWEsd0RBQWUsQ0FBQyxpREFBUTtBQUNyQyxnQkFBZ0IsaURBQVEsTUFBTSx1REFBYztBQUM1QztBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0QseUJBQXlCLCtEQUFzQixNQUFNLGtEQUFTLGdCQUFnQixrREFBUyxDQUFDLG9EQUFXO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxnREFBTztBQUN4QyxVQUFVLGlEQUFRO0FBQ2xCLFVBQVUsaURBQVE7QUFDbEIsVUFBVSxpREFBUTtBQUNsQixrQkFBa0IsaURBQVEsTUFBTSxtREFBVTtBQUMxQyxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGlEQUFRLENBQUMsaURBQVE7QUFDL0IsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlEQUFRO0FBQ2pCLFNBQVMs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QUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUssT0FBTyxzREFBa0I7O0FBRTlCLDJDQUEyQztBQUMzQztBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDhDQUE4QyxrREFBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQSxTQUFTLFVBQVUsa0RBQWM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFaUQiLCJzb3VyY2VzIjpbIi9Vc2Vycy9nYWdlbWNjb3kvRG9jdW1lbnRzL0NoYXRHZW5pdXMvbm9kZV9tb2R1bGVzL3VwbG9hZHRoaW5nL25leHQvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgRWZmZWN0IGZyb20gJ2VmZmVjdC9FZmZlY3QnO1xuaW1wb3J0IHsgRmV0Y2hIdHRwQ2xpZW50LCBIZWFkZXJzLCBIdHRwQXBwLCBIdHRwU2VydmVyUmVzcG9uc2UsIEh0dHBTZXJ2ZXJSZXF1ZXN0LCBIdHRwUm91dGVyLCBIdHRwQ2xpZW50LCBIdHRwQ2xpZW50UmVxdWVzdCwgSHR0cENsaWVudFJlc3BvbnNlLCBIdHRwQm9keSB9IGZyb20gJ0BlZmZlY3QvcGxhdGZvcm0nO1xuaW1wb3J0ICogYXMgQ29uZmlnIGZyb20gJ2VmZmVjdC9Db25maWcnO1xuaW1wb3J0ICogYXMgQ29udGV4dCBmcm9tICdlZmZlY3QvQ29udGV4dCc7XG5pbXBvcnQgKiBhcyBNYXRjaCBmcm9tICdlZmZlY3QvTWF0Y2gnO1xuaW1wb3J0ICogYXMgUmVkYWN0ZWQgZnJvbSAnZWZmZWN0L1JlZGFjdGVkJztcbmltcG9ydCAqIGFzIFMgZnJvbSAnZWZmZWN0L1NjaGVtYSc7XG5pbXBvcnQgeyBWYWxpZENvbnRlbnREaXNwb3NpdGlvbnMsIFZhbGlkQUNMcywgZmlsdGVyRGVmaW5lZE9iamVjdFZhbHVlcywgVXBsb2FkVGhpbmdFcnJvciwgbWF0Y2hGaWxlVHlwZSwgb2JqZWN0S2V5cywgSW52YWxpZFJvdXRlQ29uZmlnRXJyb3IsIGZpbGVTaXplVG9CeXRlcywgZmlsbElucHV0Um91dGVDb25maWcsIGJ5dGVzVG9GaWxlU2l6ZSwgZ2V0U3RhdHVzQ29kZUZyb21FcnJvciwgdmVyaWZ5U2lnbmF0dXJlLCBnZW5lcmF0ZUtleSwgZ2VuZXJhdGVTaWduZWRVUkwgfSBmcm9tICdAdXBsb2FkdGhpbmcvc2hhcmVkJztcbmltcG9ydCAqIGFzIENvbmZpZ1Byb3ZpZGVyIGZyb20gJ2VmZmVjdC9Db25maWdQcm92aWRlcic7XG5pbXBvcnQgKiBhcyBTdHJlYW0gZnJvbSAnZWZmZWN0L1N0cmVhbSc7XG5pbXBvcnQgKiBhcyBMYXllciBmcm9tICdlZmZlY3QvTGF5ZXInO1xuaW1wb3J0ICogYXMgTG9nZ2VyIGZyb20gJ2VmZmVjdC9Mb2dnZXInO1xuaW1wb3J0ICogYXMgTG9nTGV2ZWwgZnJvbSAnZWZmZWN0L0xvZ0xldmVsJztcbmltcG9ydCAqIGFzIENhdXNlIGZyb20gJ2VmZmVjdC9DYXVzZSc7XG5pbXBvcnQgKiBhcyBEYXRhIGZyb20gJ2VmZmVjdC9EYXRhJztcbmltcG9ydCAqIGFzIFJ1bnRpbWUgZnJvbSAnZWZmZWN0L1J1bnRpbWUnO1xuaW1wb3J0ICogYXMgRmliZXJSZWYgZnJvbSAnZWZmZWN0L0ZpYmVyUmVmJztcbmltcG9ydCAqIGFzIE1hbmFnZWRSdW50aW1lIGZyb20gJ2VmZmVjdC9NYW5hZ2VkUnVudGltZSc7XG5pbXBvcnQgeyBVVEZpbGVzIH0gZnJvbSAnLi4vaW50ZXJuYWwvdHlwZXMuanMnO1xuZXhwb3J0IHsgVVRGaWxlcyB9IGZyb20gJy4uL2ludGVybmFsL3R5cGVzLmpzJztcblxudmFyIHZlcnNpb24gPSBcIjcuNC40XCI7XG5cblMuTGl0ZXJhbCguLi5WYWxpZENvbnRlbnREaXNwb3NpdGlvbnMpO1xuUy5MaXRlcmFsKC4uLlZhbGlkQUNMcyk7XG4vKipcbiAqIFZhbGlkIG9wdGlvbnMgZm9yIHRoZSBgP2FjdGlvblR5cGVgIHF1ZXJ5IHBhcmFtXG4gKi8gY29uc3QgQWN0aW9uVHlwZSA9IFMuTGl0ZXJhbChcInVwbG9hZFwiKTtcbi8qKlxuICogVmFsaWQgb3B0aW9ucyBmb3IgdGhlIGB1cGxvYWR0aGluZy1ob29rYCBoZWFkZXJcbiAqIGZvciByZXF1ZXN0cyBjb21pbmcgZnJvbSBVVCBzZXJ2ZXJcbiAqLyBjb25zdCBVcGxvYWRUaGluZ0hvb2sgPSBTLkxpdGVyYWwoXCJjYWxsYmFja1wiLCBcImVycm9yXCIpO1xuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09IENvbmZpZ3VyYXRpb24gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gY29uc3QgRGVjb2RlU3RyaW5nID0gUy50cmFuc2Zvcm0oUy5VaW50OEFycmF5RnJvbVNlbGYsIFMuU3RyaW5nLCB7XG4gICAgZGVjb2RlOiAoZGF0YSk9Pm5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShkYXRhKSxcbiAgICBlbmNvZGU6IChkYXRhKT0+bmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGRhdGEpXG59KTtcbmNvbnN0IFBhcnNlZFRva2VuID0gUy5TdHJ1Y3Qoe1xuICAgIGFwaUtleTogUy5SZWRhY3RlZChTLlN0cmluZy5waXBlKFMuc3RhcnRzV2l0aChcInNrX1wiKSkpLFxuICAgIGFwcElkOiBTLlN0cmluZyxcbiAgICByZWdpb25zOiBTLk5vbkVtcHR5QXJyYXkoUy5TdHJpbmcpLFxuICAgIGluZ2VzdEhvc3Q6IFMuU3RyaW5nLnBpcGUoUy5vcHRpb25hbFdpdGgoe1xuICAgICAgICBkZWZhdWx0OiAoKT0+XCJpbmdlc3QudXBsb2FkdGhpbmcuY29tXCJcbiAgICB9KSlcbn0pO1xuY29uc3QgVXBsb2FkVGhpbmdUb2tlbiA9IFMuVWludDhBcnJheUZyb21CYXNlNjQucGlwZShTLmNvbXBvc2UoRGVjb2RlU3RyaW5nKSwgUy5jb21wb3NlKFMucGFyc2VKc29uKFBhcnNlZFRva2VuKSkpO1xuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09IEZpbGUgVHlwZSBIaWVyYXJjaHkgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqLyAvKipcbiAqIFByb3BlcnRpZXMgZnJvbSB0aGUgd2ViIEZpbGUgb2JqZWN0LCB0aGlzIGlzIHdoYXQgdGhlIGNsaWVudCBzZW5kcyB3aGVuIGluaXRpYXRpbmcgYW4gdXBsb2FkXG4gKi8gY2xhc3MgRmlsZVVwbG9hZERhdGEgZXh0ZW5kcyBTLkNsYXNzKFwiRmlsZVVwbG9hZERhdGFcIikoe1xuICAgIG5hbWU6IFMuU3RyaW5nLFxuICAgIHNpemU6IFMuTnVtYmVyLFxuICAgIHR5cGU6IFMuU3RyaW5nLFxuICAgIGxhc3RNb2RpZmllZDogUy5OdW1iZXIucGlwZShTLm9wdGlvbmFsKVxufSkge1xufVxuLyoqXG4gKiBgLm1pZGRsZXdhcmUoKWAgY2FuIGFkZCBhIGN1c3RvbUlkIHRvIHRoZSBpbmNvbWluZyBmaWxlIGRhdGFcbiAqLyBjbGFzcyBGaWxlVXBsb2FkRGF0YVdpdGhDdXN0b21JZCBleHRlbmRzIEZpbGVVcGxvYWREYXRhLmV4dGVuZChcIkZpbGVVcGxvYWREYXRhV2l0aEN1c3RvbUlkXCIpKHtcbiAgICBjdXN0b21JZDogUy5OdWxsT3IoUy5TdHJpbmcpXG59KSB7XG59XG4vKipcbiAqIFdoZW4gZmlsZXMgYXJlIHVwbG9hZGVkLCB3ZSBnZXQgYmFja1xuICogLSBhIGtleVxuICogLSBhIGRpcmVjdCBVUkwgZm9yIHRoZSBmaWxlXG4gKiAtIGFuIGFwcC1zcGVjaWZpYyBVUkwgZm9yIHRoZSBmaWxlICh1c2VmdWwgZm9yIHNjb3BpbmcgZWcuIGZvciBvcHRpbWl6YXRpb24gYWxsb3dlZCBvcmlnaW5zKVxuICogLSB0aGUgaGFzaCAobWQ1LWhleCkgb2YgdGhlIHVwbG9hZGVkIGZpbGUncyBjb250ZW50c1xuICovIGNsYXNzIFVwbG9hZGVkRmlsZURhdGEgZXh0ZW5kcyBGaWxlVXBsb2FkRGF0YVdpdGhDdXN0b21JZC5leHRlbmQoXCJVcGxvYWRlZEZpbGVEYXRhXCIpKHtcbiAgICBrZXk6IFMuU3RyaW5nLFxuICAgIHVybDogUy5TdHJpbmcsXG4gICAgYXBwVXJsOiBTLlN0cmluZyxcbiAgICBmaWxlSGFzaDogUy5TdHJpbmdcbn0pIHtcbn1cbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PSBTZXJ2ZXIgUmVzcG9uc2UgU2NoZW1hcyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICovIGNsYXNzIE5ld1ByZXNpZ25lZFVybCBleHRlbmRzIFMuQ2xhc3MoXCJOZXdQcmVzaWduZWRVcmxcIikoe1xuICAgIHVybDogUy5TdHJpbmcsXG4gICAga2V5OiBTLlN0cmluZyxcbiAgICBjdXN0b21JZDogUy5OdWxsT3IoUy5TdHJpbmcpLFxuICAgIG5hbWU6IFMuU3RyaW5nXG59KSB7XG59XG5jbGFzcyBNZXRhZGF0YUZldGNoU3RyZWFtUGFydCBleHRlbmRzIFMuQ2xhc3MoXCJNZXRhZGF0YUZldGNoU3RyZWFtUGFydFwiKSh7XG4gICAgcGF5bG9hZDogUy5TdHJpbmcsXG4gICAgc2lnbmF0dXJlOiBTLlN0cmluZyxcbiAgICBob29rOiBVcGxvYWRUaGluZ0hvb2tcbn0pIHtcbn1cbmNsYXNzIE1ldGFkYXRhRmV0Y2hSZXNwb25zZSBleHRlbmRzIFMuQ2xhc3MoXCJNZXRhZGF0YUZldGNoUmVzcG9uc2VcIikoe1xuICAgIG9rOiBTLkJvb2xlYW5cbn0pIHtcbn1cbmNsYXNzIENhbGxiYWNrUmVzdWx0UmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiQ2FsbGJhY2tSZXN1bHRSZXNwb25zZVwiKSh7XG4gICAgb2s6IFMuQm9vbGVhblxufSkge1xufVxuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09IENsaWVudCBBY3Rpb24gUGF5bG9hZHMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqLyBjbGFzcyBVcGxvYWRBY3Rpb25QYXlsb2FkIGV4dGVuZHMgUy5DbGFzcyhcIlVwbG9hZEFjdGlvblBheWxvYWRcIikoe1xuICAgIGZpbGVzOiBTLkFycmF5KEZpbGVVcGxvYWREYXRhKSxcbiAgICBpbnB1dDogUy5Vbmtub3duXG59KSB7XG59XG5cbi8qKlxuICogTWVyZ2UgaW4gYGltcG9ydC5tZXRhLmVudmAgdG8gdGhlIGJ1aWx0LWluIGBwcm9jZXNzLmVudmAgcHJvdmlkZXJcbiAqIFByZWZpeCBrZXlzIHdpdGggYFVQTE9BRFRISU5HX2Agc28gd2UgY2FuIHJlZmVyZW5jZSBqdXN0IHRoZSBuYW1lLlxuICogQGV4YW1wbGVcbiAqIHByb2Nlc3MuZW52LlVQTE9BRFRISU5HX1RPS0VOID0gXCJmb29cIlxuICogQ29uZmlnLnN0cmluZyhcInRva2VuXCIpOyAvLyBDb25maWc8XCJmb29cIj5cbiAqLyBjb25zdCBlbnZQcm92aWRlciA9IENvbmZpZ1Byb3ZpZGVyLmZyb21FbnYoKS5waXBlKENvbmZpZ1Byb3ZpZGVyLm9yRWxzZSgoKT0+Q29uZmlnUHJvdmlkZXIuZnJvbU1hcChuZXcgTWFwKE9iamVjdC5lbnRyaWVzKGZpbHRlckRlZmluZWRPYmplY3RWYWx1ZXMoLy8gZnVjayB0aGlzIEkgZ2l2ZSB1cC4gaW1wb3J0Lm1ldGEgaXMgYSBtaXN0YWtlLCBzb21lb25lIGVsc2UgY2FuIGZpeCBpdFxuICAgIGltcG9ydC5tZXRhPy5lbnYgPz8ge30pKSksIHtcbiAgICAgICAgcGF0aERlbGltOiBcIl9cIlxuICAgIH0pKSwgQ29uZmlnUHJvdmlkZXIubmVzdGVkKFwidXBsb2FkdGhpbmdcIiksIENvbmZpZ1Byb3ZpZGVyLmNvbnN0YW50Q2FzZSk7XG4vKipcbiAqIENvbmZpZyBwcm92aWRlciB0aGF0IG1lcmdlcyB0aGUgb3B0aW9ucyBmcm9tIHRoZSBvYmplY3RcbiAqIGFuZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgcHJlZml4ZWQgd2l0aCBgVVBMT0FEVEhJTkdfYC5cbiAqIEByZW1hcmtzIE9wdGlvbnMgdGFrZSBwcmVjZWRlbmNlIG92ZXIgZW52aXJvbm1lbnQgdmFyaWFibGVzLlxuICovIGNvbnN0IGNvbmZpZ1Byb3ZpZGVyID0gKG9wdGlvbnMpPT5Db25maWdQcm92aWRlci5mcm9tSnNvbihvcHRpb25zID8/IHt9KS5waXBlKENvbmZpZ1Byb3ZpZGVyLm9yRWxzZSgoKT0+ZW52UHJvdmlkZXIpKTtcbmNvbnN0IElzRGV2ZWxvcG1lbnQgPSBDb25maWcuYm9vbGVhbihcImlzRGV2XCIpLnBpcGUoQ29uZmlnLm9yRWxzZSgoKT0+Q29uZmlnLnN1Y2NlZWQodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgPyBwcm9jZXNzLmVudi5OT0RFX0VOViA6IHVuZGVmaW5lZCkucGlwZShDb25maWcubWFwKChfKT0+XyA9PT0gXCJkZXZlbG9wbWVudFwiKSkpLCBDb25maWcud2l0aERlZmF1bHQoZmFsc2UpKTtcbmNvbnN0IFVUVG9rZW4gPSBTLkNvbmZpZyhcInRva2VuXCIsIFVwbG9hZFRoaW5nVG9rZW4pLnBpcGUoRWZmZWN0LmNhdGNoVGFncyh7XG4gICAgQ29uZmlnRXJyb3I6IChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogZS5fb3AgPT09IFwiSW52YWxpZERhdGFcIiA/IFwiSU5WQUxJRF9TRVJWRVJfQ09ORklHXCIgOiBcIk1JU1NJTkdfRU5WXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBlLl9vcCA9PT0gXCJJbnZhbGlkRGF0YVwiID8gXCJJbnZhbGlkIHRva2VuLiBBIHRva2VuIGlzIGEgYmFzZTY0IGVuY29kZWQgSlNPTiBvYmplY3QgbWF0Y2hpbmcgeyBhcGlLZXk6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgcmVnaW9uczogc3RyaW5nW10gfS5cIiA6IFwiTWlzc2luZyB0b2tlbi4gUGxlYXNlIHNldCB0aGUgYFVQTE9BRFRISU5HX1RPS0VOYCBlbnZpcm9ubWVudCB2YXJpYWJsZSBvciBwcm92aWRlIGEgdG9rZW4gbWFudWFsbHkgdGhyb3VnaCBjb25maWcuXCIsXG4gICAgICAgICAgICBjYXVzZTogZVxuICAgICAgICB9KVxufSkpO1xuQ29uZmlnLnN0cmluZyhcImFwaVVybFwiKS5waXBlKENvbmZpZy53aXRoRGVmYXVsdChcImh0dHBzOi8vYXBpLnVwbG9hZHRoaW5nLmNvbVwiKSwgQ29uZmlnLm1hcEF0dGVtcHQoKF8pPT5uZXcgVVJMKF8pKSwgQ29uZmlnLm1hcCgodXJsKT0+dXJsLmhyZWYucmVwbGFjZSgvXFwvJC8sIFwiXCIpKSk7XG5jb25zdCBJbmdlc3RVcmwgPSBFZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICBjb25zdCB7IHJlZ2lvbnMsIGluZ2VzdEhvc3QgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgIGNvbnN0IHJlZ2lvbiA9IHJlZ2lvbnNbMF07IC8vIEN1cnJlbnRseSBvbmx5IHN1cHBvcnQgMSByZWdpb24gcGVyIGFwcFxuICAgIHJldHVybiB5aWVsZCogQ29uZmlnLnN0cmluZyhcImluZ2VzdFVybFwiKS5waXBlKENvbmZpZy53aXRoRGVmYXVsdChgaHR0cHM6Ly8ke3JlZ2lvbn0uJHtpbmdlc3RIb3N0fWApLCBDb25maWcubWFwQXR0ZW1wdCgoXyk9Pm5ldyBVUkwoXykpLCBDb25maWcubWFwKCh1cmwpPT51cmwuaHJlZi5yZXBsYWNlKC9cXC8kLywgXCJcIikpKTtcbn0pO1xuXG5mdW5jdGlvbiBkZWZhdWx0RXJyb3JGb3JtYXR0ZXIoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGZvcm1hdEVycm9yKGVycm9yLCByb3V0ZXIpIHtcbiAgICBjb25zdCBlcnJvckZvcm1hdHRlciA9IHJvdXRlcltPYmplY3Qua2V5cyhyb3V0ZXIpWzBdXT8uZXJyb3JGb3JtYXR0ZXIgPz8gZGVmYXVsdEVycm9yRm9ybWF0dGVyO1xuICAgIHJldHVybiBlcnJvckZvcm1hdHRlcihlcnJvcik7XG59XG5cbmNvbnN0IGhhbmRsZUpzb25MaW5lU3RyZWFtID0gKHNjaGVtYSwgb25DaHVuayk9PihzdHJlYW0pPT57XG4gICAgICAgIGxldCBidWYgPSBcIlwiO1xuICAgICAgICByZXR1cm4gc3RyZWFtLnBpcGUoU3RyZWFtLmRlY29kZVRleHQoKSwgU3RyZWFtLm1hcEVmZmVjdCgoY2h1bmspPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgICAgICBidWYgKz0gY2h1bms7XG4gICAgICAgICAgICAgICAgLy8gU2NhbiBidWZmZXIgZm9yIG5ld2xpbmVzXG4gICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBidWYuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsaWRDaHVua3MgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpe1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB0byBwYXJzZSBjaHVuayBhcyBKU09OXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZENodW5rcy5wdXNoKEpTT04ucGFyc2UocGFydCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWR2YW5jZSBidWZmZXIgaWYgcGFyc2luZyBzdWNjZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IGJ1Zi5zbGljZShwYXJ0Lmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICB7XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJlY2VpdmVkIGNodW5rc1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJjaHVua1wiLCBjaHVuayksIEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJwYXJzZWRDaHVua3NcIiwgdmFsaWRDaHVua3MpLCBFZmZlY3QuYW5ub3RhdGVMb2dzKFwiYnVmXCIsIGJ1ZikpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZENodW5rcztcbiAgICAgICAgICAgIH0pKSwgU3RyZWFtLm1hcEVmZmVjdChTLmRlY29kZVVua25vd24oUy5BcnJheShzY2hlbWEpKSksIFN0cmVhbS5tYXBFZmZlY3QoRWZmZWN0LmZvckVhY2goKHBhcnQpPT5vbkNodW5rKHBhcnQpKSksIFN0cmVhbS5ydW5EcmFpbiwgRWZmZWN0LndpdGhMb2dTcGFuKFwiaGFuZGxlSnNvbkxpbmVTdHJlYW1cIikpO1xuICAgIH07XG5cbmNvbnN0IHdpdGhNaW5pbWFsTG9nTGV2ZWwgPSBDb25maWcubG9nTGV2ZWwoXCJsb2dMZXZlbFwiKS5waXBlKENvbmZpZy53aXRoRGVmYXVsdChMb2dMZXZlbC5JbmZvKSwgRWZmZWN0LmFuZFRoZW4oKGxldmVsKT0+TG9nZ2VyLm1pbmltdW1Mb2dMZXZlbChsZXZlbCkpLCBFZmZlY3QudGFwRXJyb3IoKGUpPT5FZmZlY3QubG9nRXJyb3IoXCJJbnZhbGlkIGxvZyBsZXZlbFwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJlcnJvclwiLCBlKSkpLCBFZmZlY3QuY2F0Y2hUYWcoXCJDb25maWdFcnJvclwiLCAoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgY29kZTogXCJJTlZBTElEX1NFUlZFUl9DT05GSUdcIixcbiAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHNlcnZlciBjb25maWd1cmF0aW9uXCIsXG4gICAgICAgIGNhdXNlOiBlXG4gICAgfSkpLCBMYXllci51bndyYXBFZmZlY3QpO1xuY29uc3QgTG9nRm9ybWF0ID0gQ29uZmlnLmxpdGVyYWwoXCJqc29uXCIsIFwibG9nRm10XCIsIFwic3RydWN0dXJlZFwiLCBcInByZXR0eVwiKShcImxvZ0Zvcm1hdFwiKTtcbmNvbnN0IHdpdGhMb2dGb3JtYXQgPSBFZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICBjb25zdCBpc0RldiA9IHlpZWxkKiBJc0RldmVsb3BtZW50O1xuICAgIGNvbnN0IGxvZ0Zvcm1hdCA9IHlpZWxkKiBMb2dGb3JtYXQucGlwZShDb25maWcud2l0aERlZmF1bHQoaXNEZXYgPyBcInByZXR0eVwiIDogXCJqc29uXCIpKTtcbiAgICByZXR1cm4gTG9nZ2VyW2xvZ0Zvcm1hdF07XG59KS5waXBlKEVmZmVjdC5jYXRjaFRhZyhcIkNvbmZpZ0Vycm9yXCIsIChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICBjb2RlOiBcIklOVkFMSURfU0VSVkVSX0NPTkZJR1wiLFxuICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgc2VydmVyIGNvbmZpZ3VyYXRpb25cIixcbiAgICAgICAgY2F1c2U6IGVcbiAgICB9KSksIExheWVyLnVud3JhcEVmZmVjdCk7XG5jb25zdCBsb2dIdHRwQ2xpZW50UmVzcG9uc2UgPSAobWVzc2FnZSwgb3B0cyk9PntcbiAgICBjb25zdCBtaXhpbiA9IG9wdHM/Lm1peGluID8/IFwianNvblwiO1xuICAgIGNvbnN0IGxldmVsID0gTG9nTGV2ZWwuZnJvbUxpdGVyYWwob3B0cz8ubGV2ZWwgPz8gXCJEZWJ1Z1wiKTtcbiAgICByZXR1cm4gKHJlc3BvbnNlKT0+RWZmZWN0LmZsYXRNYXAobWl4aW4gIT09IFwiTm9uZVwiID8gcmVzcG9uc2VbbWl4aW5dIDogRWZmZWN0LnZvaWQsICgpPT5FZmZlY3QubG9nV2l0aExldmVsKGxldmVsLCBgJHttZXNzYWdlfSAoJHtyZXNwb25zZS5zdGF0dXN9KWApLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJlc3BvbnNlXCIsIHJlc3BvbnNlKSkpO1xufTtcbmNvbnN0IGxvZ0h0dHBDbGllbnRFcnJvciA9IChtZXNzYWdlKT0+KGVycik9PmVyci5fdGFnID09PSBcIlJlc3BvbnNlRXJyb3JcIiA/IGxvZ0h0dHBDbGllbnRSZXNwb25zZShtZXNzYWdlLCB7XG4gICAgICAgICAgICBsZXZlbDogXCJFcnJvclwiXG4gICAgICAgIH0pKGVyci5yZXNwb25zZSkgOiBFZmZlY3QubG9nRXJyb3IobWVzc2FnZSkucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiZXJyb3JcIiwgZXJyKSk7XG5cbmNsYXNzIFBhcnNlckVycm9yIGV4dGVuZHMgRGF0YS5UYWdnZWRFcnJvcihcIlBhcnNlckVycm9yXCIpIHtcbiAgICBjb25zdHJ1Y3RvciguLi5hcmdzKXtcbiAgICAgICAgc3VwZXIoLi4uYXJncyksIHRoaXMubWVzc2FnZSA9IFwiSW5wdXQgdmFsaWRhdGlvbiBmYWlsZWQuIFRoZSBvcmlnaW5hbCBlcnJvciB3aXRoIGl0J3MgdmFsaWRhdGlvbiBpc3N1ZXMgaXMgaW4gdGhlIGVycm9yIGNhdXNlLlwiO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldFBhcnNlRm4ocGFyc2VyKSB7XG4gICAgaWYgKFwifnN0YW5kYXJkXCIgaW4gcGFyc2VyKSB7XG4gICAgICAgIC8qKlxuICAgICAqIFN0YW5kYXJkIFNjaGVtYVxuICAgICAqLyByZXR1cm4gYXN5bmMgKHZhbHVlKT0+e1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGFyc2VyW1wifnN0YW5kYXJkXCJdLnZhbGlkYXRlKHZhbHVlKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQuaXNzdWVzKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBhcnNlckVycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IHJlc3VsdC5pc3N1ZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQudmFsdWU7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGlmIChcInBhcnNlQXN5bmNcIiBpbiBwYXJzZXIgJiYgdHlwZW9mIHBhcnNlci5wYXJzZUFzeW5jID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgLyoqXG4gICAgICogWm9kXG4gICAgICogVE9ETyAobmV4dCBtYWpvcik6IENvbnNpZGVyIHdyYXBwaW5nIFpvZEVycm9yIGluIFBhcnNlckVycm9yXG4gICAgICovIHJldHVybiBwYXJzZXIucGFyc2VBc3luYztcbiAgICB9XG4gICAgaWYgKFMuaXNTY2hlbWEocGFyc2VyKSkge1xuICAgICAgICAvKipcbiAgICAgKiBFZmZlY3QgU2NoZW1hXG4gICAgICovIHJldHVybiAodmFsdWUpPT5TLmRlY29kZVVua25vd25Qcm9taXNlKHBhcnNlcikodmFsdWUpLmNhdGNoKChlcnJvcik9PntcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFyc2VyRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjYXVzZTogQ2F1c2Uuc3F1YXNoKGVycm9yW1J1bnRpbWUuRmliZXJGYWlsdXJlQ2F1c2VJZF0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJzZXJcIik7XG59XG5cbmNsYXNzIEZpbGVTaXplTWlzbWF0Y2ggZXh0ZW5kcyBEYXRhLkVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlLCBtYXgsIGFjdHVhbCl7XG4gICAgICAgIGNvbnN0IHJlYXNvbiA9IGBZb3UgdXBsb2FkZWQgYSAke3R5cGV9IGZpbGUgdGhhdCB3YXMgJHtieXRlc1RvRmlsZVNpemUoYWN0dWFsKX0sIGJ1dCB0aGUgbGltaXQgZm9yIHRoYXQgdHlwZSBpcyAke21heH1gO1xuICAgICAgICBzdXBlcih7XG4gICAgICAgICAgICByZWFzb25cbiAgICAgICAgfSksIHRoaXMuX3RhZyA9IFwiRmlsZVNpemVNaXNtYXRjaFwiLCB0aGlzLm5hbWUgPSBcIkZpbGVTaXplTWlzbWF0Y2hFcnJvclwiO1xuICAgIH1cbn1cbmNsYXNzIEZpbGVDb3VudE1pc21hdGNoIGV4dGVuZHMgRGF0YS5FcnJvciB7XG4gICAgY29uc3RydWN0b3IodHlwZSwgYm91bmR0eXBlLCBib3VuZCwgYWN0dWFsKXtcbiAgICAgICAgY29uc3QgcmVhc29uID0gYFlvdSB1cGxvYWRlZCAke2FjdHVhbH0gZmlsZShzKSBvZiB0eXBlICcke3R5cGV9JywgYnV0IHRoZSAke2JvdW5kdHlwZX0gZm9yIHRoYXQgdHlwZSBpcyAke2JvdW5kfWA7XG4gICAgICAgIHN1cGVyKHtcbiAgICAgICAgICAgIHJlYXNvblxuICAgICAgICB9KSwgdGhpcy5fdGFnID0gXCJGaWxlQ291bnRNaXNtYXRjaFwiLCB0aGlzLm5hbWUgPSBcIkZpbGVDb3VudE1pc21hdGNoRXJyb3JcIjtcbiAgICB9XG59XG4vLyBWZXJpZnkgdGhhdCB0aGUgdXBsb2FkZWQgZmlsZXMgZG9lc24ndCB2aW9sYXRlIHRoZSByb3V0ZSBjb25maWcsXG4vLyBlLmcuIHVwbG9hZGluZyBtb3JlIHZpZGVvcyB0aGFuIGFsbG93ZWQsIG9yIGEgZmlsZSB0aGF0IGlzIGxhcmdlciB0aGFuIGFsbG93ZWQuXG4vLyBUaGlzIGlzIGRvdWJsZS1jaGVja2VkIG9uIGluZnJhIHNpZGUsIGJ1dCB3ZSB3YW50IHRvIGZhaWwgZWFybHkgdG8gYXZvaWQgbmV0d29yayBsYXRlbmN5LlxuY29uc3QgYXNzZXJ0RmlsZXNNZWV0Q29uZmlnID0gKGZpbGVzLCByb3V0ZUNvbmZpZyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCBjb3VudHMgPSB7fTtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB5aWVsZCogbWF0Y2hGaWxlVHlwZShmaWxlLCBvYmplY3RLZXlzKHJvdXRlQ29uZmlnKSk7XG4gICAgICAgICAgICBjb3VudHNbdHlwZV0gPSAoY291bnRzW3R5cGVdID8/IDApICsgMTtcbiAgICAgICAgICAgIGNvbnN0IHNpemVMaW1pdCA9IHJvdXRlQ29uZmlnW3R5cGVdPy5tYXhGaWxlU2l6ZTtcbiAgICAgICAgICAgIGlmICghc2l6ZUxpbWl0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgSW52YWxpZFJvdXRlQ29uZmlnRXJyb3IodHlwZSwgXCJtYXhGaWxlU2l6ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNpemVMaW1pdEJ5dGVzID0geWllbGQqIGZpbGVTaXplVG9CeXRlcyhzaXplTGltaXQpO1xuICAgICAgICAgICAgaWYgKGZpbGUuc2l6ZSA+IHNpemVMaW1pdEJ5dGVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgRmlsZVNpemVNaXNtYXRjaCh0eXBlLCBzaXplTGltaXQsIGZpbGUuc2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yKGNvbnN0IF9rZXkgaW4gY291bnRzKXtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IF9rZXk7XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSByb3V0ZUNvbmZpZ1trZXldO1xuICAgICAgICAgICAgaWYgKCFjb25maWcpIHJldHVybiB5aWVsZCogbmV3IEludmFsaWRSb3V0ZUNvbmZpZ0Vycm9yKGtleSk7XG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IGNvdW50c1trZXldO1xuICAgICAgICAgICAgY29uc3QgbWluID0gY29uZmlnLm1pbkZpbGVDb3VudDtcbiAgICAgICAgICAgIGNvbnN0IG1heCA9IGNvbmZpZy5tYXhGaWxlQ291bnQ7XG4gICAgICAgICAgICBpZiAobWluID4gbWF4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIGNvbmZpZyBkdXJpbmcgZmlsZSBjb3VudCAtIG1pbkZpbGVDb3VudCA+IG1heEZpbGVDb3VudFwiLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogYG1pbkZpbGVDb3VudCBtdXN0IGJlIGxlc3MgdGhhbiBtYXhGaWxlQ291bnQgZm9yIGtleSAke2tleX0uIGdvdDogJHttaW59ID4gJHttYXh9YFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvdW50IDwgbWluKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgRmlsZUNvdW50TWlzbWF0Y2goa2V5LCBcIm1pbmltdW1cIiwgbWluLCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY291bnQgPiBtYXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBGaWxlQ291bnRNaXNtYXRjaChrZXksIFwibWF4aW11bVwiLCBtYXgsIGNvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9KTtcbmNvbnN0IGV4dHJhY3RSb3V0ZXJDb25maWcgPSAocm91dGVyKT0+RWZmZWN0LmZvckVhY2gob2JqZWN0S2V5cyhyb3V0ZXIpLCAoc2x1Zyk9PkVmZmVjdC5tYXAoZmlsbElucHV0Um91dGVDb25maWcocm91dGVyW3NsdWddLnJvdXRlckNvbmZpZyksIChjb25maWcpPT4oe1xuICAgICAgICAgICAgICAgIHNsdWcsXG4gICAgICAgICAgICAgICAgY29uZmlnXG4gICAgICAgICAgICB9KSkpO1xuXG5jb25zdCBtYWtlUnVudGltZSA9IChmZXRjaCwgY29uZmlnKT0+e1xuICAgIGNvbnN0IGZldGNoSHR0cENsaWVudCA9IExheWVyLnByb3ZpZGVNZXJnZShGZXRjaEh0dHBDbGllbnQubGF5ZXIsIExheWVyLnN1Y2NlZWQoRmV0Y2hIdHRwQ2xpZW50LkZldGNoLCBmZXRjaCkpO1xuICAgIGNvbnN0IHdpdGhSZWRhY3RlZEhlYWRlcnMgPSBMYXllci5lZmZlY3REaXNjYXJkKEZpYmVyUmVmLnVwZGF0ZShIZWFkZXJzLmN1cnJlbnRSZWRhY3RlZE5hbWVzLCAoXyk9Pl8uY29uY2F0KFtcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1hcGkta2V5XCJcbiAgICAgICAgXSkpKTtcbiAgICBjb25zdCBsYXllciA9IExheWVyLnByb3ZpZGUoTGF5ZXIubWVyZ2VBbGwod2l0aExvZ0Zvcm1hdCwgd2l0aE1pbmltYWxMb2dMZXZlbCwgZmV0Y2hIdHRwQ2xpZW50LCB3aXRoUmVkYWN0ZWRIZWFkZXJzKSwgTGF5ZXIuc2V0Q29uZmlnUHJvdmlkZXIoY29uZmlnUHJvdmlkZXIoY29uZmlnKSkpO1xuICAgIHJldHVybiBNYW5hZ2VkUnVudGltZS5tYWtlKGxheWVyKTtcbn07XG5cbmNsYXNzIEFkYXB0ZXJBcmd1bWVudHMgZXh0ZW5kcyBDb250ZXh0LlRhZyhcInVwbG9hZHRoaW5nL0FkYXB0ZXJBcmd1bWVudHNcIikoKSB7XG59XG5jb25zdCBtYWtlQWRhcHRlckhhbmRsZXIgPSAobWFrZUFkYXB0ZXJBcmdzLCB0b1JlcXVlc3QsIG9wdHMsIGJlQWRhcHRlcik9PntcbiAgICBjb25zdCBtYW5hZ2VkID0gbWFrZVJ1bnRpbWUob3B0cy5jb25maWc/LmZldGNoLCBvcHRzLmNvbmZpZyk7XG4gICAgY29uc3QgaGFuZGxlID0gRWZmZWN0LnByb21pc2UoKCk9Pm1hbmFnZWQucnVudGltZSgpLnRoZW4oSHR0cEFwcC50b1dlYkhhbmRsZXJSdW50aW1lKSk7XG4gICAgY29uc3QgYXBwID0gKC4uLmFyZ3MpPT5FZmZlY3QubWFwKEVmZmVjdC5wcm9taXNlKCgpPT5tYW5hZ2VkLnJ1blByb21pc2UoY3JlYXRlUmVxdWVzdEhhbmRsZXIob3B0cywgYmVBZGFwdGVyKSkpLCBFZmZlY3QucHJvdmlkZVNlcnZpY2VFZmZlY3QoQWRhcHRlckFyZ3VtZW50cywgbWFrZUFkYXB0ZXJBcmdzKC4uLmFyZ3MpKSk7XG4gICAgcmV0dXJuIGFzeW5jICguLi5hcmdzKT0+e1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGUucGlwZShFZmZlY3QuYXAoYXBwKC4uLmFyZ3MpKSwgRWZmZWN0LmFwKHRvUmVxdWVzdCguLi5hcmdzKSksIEVmZmVjdC53aXRoTG9nU3BhbihcInJlcXVlc3RIYW5kbGVyXCIpLCBtYW5hZ2VkLnJ1blByb21pc2UpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG59O1xuY29uc3QgY3JlYXRlUmVxdWVzdEhhbmRsZXIgPSAob3B0cywgYmVBZGFwdGVyKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IGlzRGV2ZWxvcG1lbnQgPSB5aWVsZCogSXNEZXZlbG9wbWVudDtcbiAgICAgICAgY29uc3Qgcm91dGVyQ29uZmlnID0geWllbGQqIGV4dHJhY3RSb3V0ZXJDb25maWcob3B0cy5yb3V0ZXIpO1xuICAgICAgICBjb25zdCBoYW5kbGVEYWVtb24gPSAoKCk9PntcbiAgICAgICAgICAgIGlmIChvcHRzLmNvbmZpZz8uaGFuZGxlRGFlbW9uUHJvbWlzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcHRzLmNvbmZpZy5oYW5kbGVEYWVtb25Qcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGlzRGV2ZWxvcG1lbnQgPyBcInZvaWRcIiA6IFwiYXdhaXRcIjtcbiAgICAgICAgfSkoKTtcbiAgICAgICAgaWYgKGlzRGV2ZWxvcG1lbnQgJiYgaGFuZGxlRGFlbW9uID09PSBcImF3YWl0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5WQUxJRF9TRVJWRVJfQ09ORklHXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ2hhbmRsZURhZW1vblByb21pc2U6IFwiYXdhaXRcIiBpcyBmb3JiaWRkZW4gaW4gZGV2ZWxvcG1lbnQuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgR0VUID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIEh0dHBTZXJ2ZXJSZXNwb25zZS5qc29uKHJvdXRlckNvbmZpZyk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBQT1NUID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICBjb25zdCB7IFwidXBsb2FkdGhpbmctaG9va1wiOiB1cGxvYWR0aGluZ0hvb2ssIFwieC11cGxvYWR0aGluZy1wYWNrYWdlXCI6IGZlUGFja2FnZSwgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogY2xpZW50VmVyc2lvbiB9ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUhlYWRlcnMoUy5TdHJ1Y3Qoe1xuICAgICAgICAgICAgICAgIFwidXBsb2FkdGhpbmctaG9va1wiOiBVcGxvYWRUaGluZ0hvb2sucGlwZShTLm9wdGlvbmFsKSxcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctcGFja2FnZVwiOiBTLlN0cmluZy5waXBlKFMub3B0aW9uYWxXaXRoKHtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogKCk9PlwidW5rbm93blwiXG4gICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCI6IFMuU3RyaW5nLnBpcGUoUy5vcHRpb25hbFdpdGgoe1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiAoKT0+dmVyc2lvblxuICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaWYgKGNsaWVudFZlcnNpb24gIT09IHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2ZXJWZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ1dhcm5pbmcoXCJDbGllbnQgdmVyc2lvbiBtaXNtYXRjaC4gVGhpbmdzIG1heSBub3Qgd29yayBhcyBleHBlY3RlZCwgcGxlYXNlIHN5bmMgeW91ciB2ZXJzaW9ucyB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS5cIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKHtcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50VmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyVmVyc2lvblxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgc2x1ZywgYWN0aW9uVHlwZSB9ID0geWllbGQqIEh0dHBSb3V0ZXIuc2NoZW1hUGFyYW1zKFMuU3RydWN0KHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBBY3Rpb25UeXBlLnBpcGUoUy5vcHRpb25hbCksXG4gICAgICAgICAgICAgICAgc2x1ZzogUy5TdHJpbmdcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IHVwbG9hZGFibGUgPSBvcHRzLnJvdXRlcltzbHVnXTtcbiAgICAgICAgICAgIGlmICghdXBsb2FkYWJsZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9IGBObyBmaWxlIHJvdXRlIGZvdW5kIGZvciBzbHVnICR7c2x1Z31gO1xuICAgICAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IobXNnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJOT1RfRk9VTkRcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbXNnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGJvZHksIGZpYmVyIH0gPSB5aWVsZCogTWF0Y2gudmFsdWUoe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGUsXG4gICAgICAgICAgICAgICAgdXBsb2FkdGhpbmdIb29rXG4gICAgICAgICAgICB9KS5waXBlKE1hdGNoLndoZW4oe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IFwidXBsb2FkXCIsXG4gICAgICAgICAgICAgICAgdXBsb2FkdGhpbmdIb29rOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH0sICgpPT5oYW5kbGVVcGxvYWRBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRhYmxlLFxuICAgICAgICAgICAgICAgICAgICBmZVBhY2thZ2UsXG4gICAgICAgICAgICAgICAgICAgIGJlQWRhcHRlcixcbiAgICAgICAgICAgICAgICAgICAgc2x1Z1xuICAgICAgICAgICAgICAgIH0pKSwgTWF0Y2gud2hlbih7XG4gICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVwbG9hZHRoaW5nSG9vazogXCJjYWxsYmFja1wiXG4gICAgICAgICAgICB9LCAoKT0+aGFuZGxlQ2FsbGJhY2tSZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkYWJsZSxcbiAgICAgICAgICAgICAgICAgICAgZmVQYWNrYWdlLFxuICAgICAgICAgICAgICAgICAgICBiZUFkYXB0ZXJcbiAgICAgICAgICAgICAgICB9KSksIE1hdGNoLndoZW4oe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1cGxvYWR0aGluZ0hvb2s6IFwiZXJyb3JcIlxuICAgICAgICAgICAgfSwgKCk9PmhhbmRsZUVycm9yUmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGFibGVcbiAgICAgICAgICAgICAgICB9KSksIE1hdGNoLm9yRWxzZSgoKT0+RWZmZWN0LnN1Y2NlZWQoe1xuICAgICAgICAgICAgICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBmaWJlcjogbnVsbFxuICAgICAgICAgICAgICAgIH0pKSk7XG4gICAgICAgICAgICBpZiAoZmliZXIpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiUnVubmluZyBmaWJlciBhcyBkYWVtb25cIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiaGFuZGxlRGFlbW9uXCIsIGhhbmRsZURhZW1vbikpO1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVEYWVtb24gPT09IFwidm9pZFwiKSA7IGVsc2UgaWYgKGhhbmRsZURhZW1vbiA9PT0gXCJhd2FpdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkKiBmaWJlci5hd2FpdDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBoYW5kbGVEYWVtb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVEYWVtb24oRWZmZWN0LnJ1blByb21pc2UoZmliZXIuYXdhaXQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiU2VuZGluZyByZXNwb25zZVwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJib2R5XCIsIGJvZHkpKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogSHR0cFNlcnZlclJlc3BvbnNlLmpzb24oYm9keSk7XG4gICAgICAgIH0pLnBpcGUoRWZmZWN0LmNhdGNoVGFncyh7XG4gICAgICAgICAgICBQYXJzZUVycm9yOiAoZSk9Pkh0dHBTZXJ2ZXJSZXNwb25zZS5qc29uKGZvcm1hdEVycm9yKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGUubWVzc2FnZVxuICAgICAgICAgICAgICAgIH0pLCBvcHRzLnJvdXRlciksIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA0MDBcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIFVwbG9hZFRoaW5nRXJyb3I6IChlKT0+Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgICAgICAgICBIdHRwU2VydmVyUmVzcG9uc2UuanNvbihmb3JtYXRFcnJvcihlLCBvcHRzLnJvdXRlciksIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBnZXRTdGF0dXNDb2RlRnJvbUVycm9yKGUpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCBhcHBlbmRSZXNwb25zZUhlYWRlcnMgPSBFZmZlY3QubWFwKEh0dHBTZXJ2ZXJSZXNwb25zZS5zZXRIZWFkZXIoXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIiwgdmVyc2lvbikpO1xuICAgICAgICByZXR1cm4gSHR0cFJvdXRlci5lbXB0eS5waXBlKEh0dHBSb3V0ZXIuZ2V0KFwiKlwiLCBHRVQpLCBIdHRwUm91dGVyLnBvc3QoXCIqXCIsIFBPU1QpLCBIdHRwUm91dGVyLnVzZShhcHBlbmRSZXNwb25zZUhlYWRlcnMpKTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImNyZWF0ZVJlcXVlc3RIYW5kbGVyXCIpKTtcbmNvbnN0IGhhbmRsZUVycm9yUmVxdWVzdCA9IChvcHRzKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IHsgdXBsb2FkYWJsZSB9ID0gb3B0cztcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5IdHRwU2VydmVyUmVxdWVzdDtcbiAgICAgICAgY29uc3QgeyBhcGlLZXkgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgICAgICBjb25zdCB2ZXJpZmllZCA9IHlpZWxkKiB2ZXJpZnlTaWduYXR1cmUoKHlpZWxkKiByZXF1ZXN0LnRleHQpLCByZXF1ZXN0LmhlYWRlcnNbXCJ4LXVwbG9hZHRoaW5nLXNpZ25hdHVyZVwiXSwgYXBpS2V5KTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhgU2lnbmF0dXJlIHZlcmlmaWVkOiAke3ZlcmlmaWVkfWApO1xuICAgICAgICBpZiAoIXZlcmlmaWVkKSB7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKFwiSW52YWxpZCBzaWduYXR1cmVcIik7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHNpZ25hdHVyZVwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXF1ZXN0SW5wdXQgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3Quc2NoZW1hQm9keUpzb24oUy5TdHJ1Y3Qoe1xuICAgICAgICAgICAgZmlsZUtleTogUy5TdHJpbmcsXG4gICAgICAgICAgICBlcnJvcjogUy5TdHJpbmdcbiAgICAgICAgfSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiSGFuZGxpbmcgZXJyb3IgY2FsbGJhY2sgcmVxdWVzdCB3aXRoIGlucHV0OlwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJqc29uXCIsIHJlcXVlc3RJbnB1dCkpO1xuICAgICAgICBjb25zdCBhZGFwdGVyQXJncyA9IHlpZWxkKiBBZGFwdGVyQXJndW1lbnRzO1xuICAgICAgICBjb25zdCBmaWJlciA9IHlpZWxkKiBFZmZlY3QudHJ5UHJvbWlzZSh7XG4gICAgICAgICAgICB0cnk6IGFzeW5jICgpPT51cGxvYWRhYmxlLm9uVXBsb2FkRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAuLi5hZGFwdGVyQXJncyxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiVVBMT0FEX0ZBSUxFRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYFVwbG9hZCBmYWlsZWQgZm9yICR7cmVxdWVzdElucHV0LmZpbGVLZXl9OiAke3JlcXVlc3RJbnB1dC5lcnJvcn1gXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICBmaWxlS2V5OiByZXF1ZXN0SW5wdXQuZmlsZUtleVxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2F0Y2g6IChlcnJvcik9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcnVuIG9uVXBsb2FkRXJyb3JcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSkucGlwZShFZmZlY3QudGFwRXJyb3IoKGVycm9yKT0+RWZmZWN0LmxvZ0Vycm9yKFwiRmFpbGVkIHRvIHJ1biBvblVwbG9hZEVycm9yLiBZb3UgcHJvYmFibHkgc2hvdWxkbid0IGJlIHRocm93aW5nIGVycm9ycyBoZXJlLlwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJlcnJvclwiLCBlcnJvcikpKSkucGlwZShFZmZlY3QuaWdub3JlTG9nZ2VkLCBFZmZlY3QuZm9ya0RhZW1vbik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICAgICAgZmliZXJcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImhhbmRsZUVycm9yUmVxdWVzdFwiKSk7XG5jb25zdCBoYW5kbGVDYWxsYmFja1JlcXVlc3QgPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCB7IHVwbG9hZGFibGUsIGZlUGFja2FnZSwgYmVBZGFwdGVyIH0gPSBvcHRzO1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0Lkh0dHBTZXJ2ZXJSZXF1ZXN0O1xuICAgICAgICBjb25zdCB7IGFwaUtleSB9ID0geWllbGQqIFVUVG9rZW47XG4gICAgICAgIGNvbnN0IHZlcmlmaWVkID0geWllbGQqIHZlcmlmeVNpZ25hdHVyZSgoeWllbGQqIHJlcXVlc3QudGV4dCksIHJlcXVlc3QuaGVhZGVyc1tcIngtdXBsb2FkdGhpbmctc2lnbmF0dXJlXCJdLCBhcGlLZXkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKGBTaWduYXR1cmUgdmVyaWZpZWQ6ICR7dmVyaWZpZWR9YCk7XG4gICAgICAgIGlmICghdmVyaWZpZWQpIHtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IoXCJJbnZhbGlkIHNpZ25hdHVyZVwiKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgc2lnbmF0dXJlXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlcXVlc3RJbnB1dCA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5zY2hlbWFCb2R5SnNvbihTLlN0cnVjdCh7XG4gICAgICAgICAgICBzdGF0dXM6IFMuU3RyaW5nLFxuICAgICAgICAgICAgZmlsZTogVXBsb2FkZWRGaWxlRGF0YSxcbiAgICAgICAgICAgIG1ldGFkYXRhOiBTLlJlY29yZCh7XG4gICAgICAgICAgICAgICAga2V5OiBTLlN0cmluZyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogUy5Vbmtub3duXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJIYW5kbGluZyBjYWxsYmFjayByZXF1ZXN0IHdpdGggaW5wdXQ6XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImpzb25cIiwgcmVxdWVzdElucHV0KSk7XG4gICAgICAgIC8qKlxuICAgICAqIFJ1biBgLm9uVXBsb2FkQ29tcGxldGVgIGFzIGEgZGFlbW9uIHRvIHByZXZlbnQgdGhlXG4gICAgICogcmVxdWVzdCBmcm9tIFVUIHRvIHBvdGVudGlhbGx5IHRpbWVvdXQuXG4gICAgICovIGNvbnN0IGZpYmVyID0geWllbGQqIEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgY29uc3QgYWRhcHRlckFyZ3MgPSB5aWVsZCogQWRhcHRlckFyZ3VtZW50cztcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlckRhdGEgPSB5aWVsZCogRWZmZWN0LnRyeVByb21pc2Uoe1xuICAgICAgICAgICAgICAgIHRyeTogYXN5bmMgKCk9PnVwbG9hZGFibGUub25VcGxvYWRDb21wbGV0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5hZGFwdGVyQXJncyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IHJlcXVlc3RJbnB1dC5maWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IHJlcXVlc3RJbnB1dC5tZXRhZGF0YVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaDogKGVycm9yKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJ1biBvblVwbG9hZENvbXBsZXRlLiBZb3UgcHJvYmFibHkgc2hvdWxkbid0IGJlIHRocm93aW5nIGVycm9ycyBoZXJlLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgZmlsZUtleTogcmVxdWVzdElucHV0LmZpbGUua2V5LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrRGF0YTogc2VydmVyRGF0YSA/PyBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIidvblVwbG9hZENvbXBsZXRlJyBjYWxsYmFjayBmaW5pc2hlZC4gU2VuZGluZyByZXNwb25zZSB0byBVcGxvYWRUaGluZzpcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiY2FsbGJhY2tEYXRhXCIsIHBheWxvYWQpKTtcbiAgICAgICAgICAgIGNvbnN0IGJhc2VVcmwgPSB5aWVsZCogSW5nZXN0VXJsO1xuICAgICAgICAgICAgY29uc3QgaHR0cENsaWVudCA9ICh5aWVsZCogSHR0cENsaWVudC5IdHRwQ2xpZW50KS5waXBlKEh0dHBDbGllbnQuZmlsdGVyU3RhdHVzT2spO1xuICAgICAgICAgICAgeWllbGQqIEh0dHBDbGllbnRSZXF1ZXN0LnBvc3QoYC9jYWxsYmFjay1yZXN1bHRgKS5waXBlKEh0dHBDbGllbnRSZXF1ZXN0LnByZXBlbmRVcmwoYmFzZVVybCksIEh0dHBDbGllbnRSZXF1ZXN0LnNldEhlYWRlcnMoe1xuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1hcGkta2V5XCI6IFJlZGFjdGVkLnZhbHVlKGFwaUtleSksXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogdmVyc2lvbixcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYmUtYWRhcHRlclwiOiBiZUFkYXB0ZXIsXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWZlLXBhY2thZ2VcIjogZmVQYWNrYWdlXG4gICAgICAgICAgICB9KSwgSHR0cENsaWVudFJlcXVlc3QuYm9keUpzb24ocGF5bG9hZCksIEVmZmVjdC5mbGF0TWFwKGh0dHBDbGllbnQuZXhlY3V0ZSksIEVmZmVjdC50YXBFcnJvcihsb2dIdHRwQ2xpZW50RXJyb3IoXCJGYWlsZWQgdG8gcmVnaXN0ZXIgY2FsbGJhY2sgcmVzdWx0XCIpKSwgRWZmZWN0LmZsYXRNYXAoSHR0cENsaWVudFJlc3BvbnNlLnNjaGVtYUJvZHlKc29uKENhbGxiYWNrUmVzdWx0UmVzcG9uc2UpKSwgRWZmZWN0LnRhcChFZmZlY3QubG9nKFwiU2VudCBjYWxsYmFjayByZXN1bHQgdG8gVXBsb2FkVGhpbmdcIikpLCBFZmZlY3Quc2NvcGVkKTtcbiAgICAgICAgfSkucGlwZShFZmZlY3QuaWdub3JlTG9nZ2VkLCBFZmZlY3QuZm9ya0RhZW1vbik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICAgICAgZmliZXJcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImhhbmRsZUNhbGxiYWNrUmVxdWVzdFwiKSk7XG5jb25zdCBydW5Sb3V0ZU1pZGRsZXdhcmUgPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCB7IGpzb246IHsgZmlsZXMsIGlucHV0IH0sIHVwbG9hZGFibGUgfSA9IG9wdHM7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJSdW5uaW5nIG1pZGRsZXdhcmVcIik7XG4gICAgICAgIGNvbnN0IGFkYXB0ZXJBcmdzID0geWllbGQqIEFkYXB0ZXJBcmd1bWVudHM7XG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgICAgIHRyeTogYXN5bmMgKCk9PnVwbG9hZGFibGUubWlkZGxld2FyZSh7XG4gICAgICAgICAgICAgICAgICAgIC4uLmFkYXB0ZXJBcmdzLFxuICAgICAgICAgICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgICAgICAgICAgICAgZmlsZXNcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNhdGNoOiAoZXJyb3IpPT5lcnJvciBpbnN0YW5jZW9mIFVwbG9hZFRoaW5nRXJyb3IgPyBlcnJvciA6IG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcnVuIG1pZGRsZXdhcmVcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChtZXRhZGF0YVtVVEZpbGVzXSAmJiBtZXRhZGF0YVtVVEZpbGVzXS5sZW5ndGggIT09IGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgbXNnID0gYEV4cGVjdGVkIGZpbGVzIG92ZXJyaWRlIHRvIGhhdmUgdGhlIHNhbWUgbGVuZ3RoIGFzIG9yaWdpbmFsIGZpbGVzLCBnb3QgJHttZXRhZGF0YVtVVEZpbGVzXS5sZW5ndGh9IGJ1dCBleHBlY3RlZCAke2ZpbGVzLmxlbmd0aH1gO1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dFcnJvcihtc2cpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmlsZXMgb3ZlcnJpZGUgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aCBhcyBmaWxlc1wiLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBtc2dcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIEF0dGFjaCBjdXN0b21JZHMgZnJvbSBtaWRkbGV3YXJlIHRvIHRoZSBmaWxlc1xuICAgICAgICBjb25zdCBmaWxlc1dpdGhDdXN0b21JZHMgPSB5aWVsZCogRWZmZWN0LmZvckVhY2goZmlsZXMsIChmaWxlLCBpZHgpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aGVpcnMgPSBtZXRhZGF0YVtVVEZpbGVzXT8uW2lkeF07XG4gICAgICAgICAgICAgICAgaWYgKHRoZWlycyAmJiB0aGVpcnMuc2l6ZSAhPT0gZmlsZS5zaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nV2FybmluZyhcIkZpbGUgc2l6ZSBtaXNtYXRjaC4gUmV2ZXJ0aW5nIHRvIG9yaWdpbmFsIHNpemVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoZWlycz8ubmFtZSA/PyBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21JZDogdGhlaXJzPy5jdXN0b21JZCxcbiAgICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiB0aGVpcnM/Lmxhc3RNb2RpZmllZCA/PyBEYXRlLm5vdygpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1ldGFkYXRhLFxuICAgICAgICAgICAgZmlsZXNXaXRoQ3VzdG9tSWRzXG4gICAgICAgIH07XG4gICAgfSkucGlwZShFZmZlY3Qud2l0aExvZ1NwYW4oXCJydW5Sb3V0ZU1pZGRsZXdhcmVcIikpO1xuY29uc3QgaGFuZGxlVXBsb2FkQWN0aW9uID0gKG9wdHMpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgY29uc3QgaHR0cENsaWVudCA9ICh5aWVsZCogSHR0cENsaWVudC5IdHRwQ2xpZW50KS5waXBlKEh0dHBDbGllbnQuZmlsdGVyU3RhdHVzT2spO1xuICAgICAgICBjb25zdCB7IHVwbG9hZGFibGUsIGZlUGFja2FnZSwgYmVBZGFwdGVyLCBzbHVnIH0gPSBvcHRzO1xuICAgICAgICBjb25zdCBqc29uID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUJvZHlKc29uKFVwbG9hZEFjdGlvblBheWxvYWQpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiSGFuZGxpbmcgdXBsb2FkIHJlcXVlc3RcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwianNvblwiLCBqc29uKSk7XG4gICAgICAgIC8vIHZhbGlkYXRlIHRoZSBpbnB1dFxuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiUGFyc2luZyB1c2VyIGlucHV0XCIpO1xuICAgICAgICBjb25zdCBwYXJzZWRJbnB1dCA9IHlpZWxkKiBFZmZlY3QudHJ5UHJvbWlzZSh7XG4gICAgICAgICAgICB0cnk6ICgpPT5nZXRQYXJzZUZuKHVwbG9hZGFibGUuaW5wdXRQYXJzZXIpKGpzb24uaW5wdXQpLFxuICAgICAgICAgICAgY2F0Y2g6IChlcnJvcik9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJJbnB1dCBwYXJzZWQgc3VjY2Vzc2Z1bGx5XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImlucHV0XCIsIHBhcnNlZElucHV0KSk7XG4gICAgICAgIGNvbnN0IHsgbWV0YWRhdGEsIGZpbGVzV2l0aEN1c3RvbUlkcyB9ID0geWllbGQqIHJ1blJvdXRlTWlkZGxld2FyZSh7XG4gICAgICAgICAgICBqc29uOiB7XG4gICAgICAgICAgICAgICAgaW5wdXQ6IHBhcnNlZElucHV0LFxuICAgICAgICAgICAgICAgIGZpbGVzOiBqc29uLmZpbGVzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkYWJsZVxuICAgICAgICB9KTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlBhcnNpbmcgcm91dGUgY29uZmlnXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJvdXRlckNvbmZpZ1wiLCB1cGxvYWRhYmxlLnJvdXRlckNvbmZpZykpO1xuICAgICAgICBjb25zdCBwYXJzZWRDb25maWcgPSB5aWVsZCogZmlsbElucHV0Um91dGVDb25maWcodXBsb2FkYWJsZS5yb3V0ZXJDb25maWcpLnBpcGUoRWZmZWN0LmNhdGNoVGFnKFwiSW52YWxpZFJvdXRlQ29uZmlnXCIsIChlcnIpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCByb3V0ZSBjb25maWdcIixcbiAgICAgICAgICAgICAgICBjYXVzZTogZXJyXG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiUm91dGUgY29uZmlnIHBhcnNlZCBzdWNjZXNzZnVsbHlcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwicm91dGVDb25maWdcIiwgcGFyc2VkQ29uZmlnKSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJWYWxpZGF0aW5nIGZpbGVzIG1lZXQgdGhlIGNvbmZpZyByZXF1aXJlbWVudHNcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiZmlsZXNcIiwganNvbi5maWxlcykpO1xuICAgICAgICB5aWVsZCogYXNzZXJ0RmlsZXNNZWV0Q29uZmlnKGpzb24uZmlsZXMsIHBhcnNlZENvbmZpZykucGlwZShFZmZlY3QubWFwRXJyb3IoKGUpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBJbnZhbGlkIGNvbmZpZzogJHtlLl90YWd9YCxcbiAgICAgICAgICAgICAgICBjYXVzZTogXCJyZWFzb25cIiBpbiBlID8gZS5yZWFzb24gOiBlLm1lc3NhZ2VcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJGaWxlcyB2YWxpZGF0ZWQuXCIpO1xuICAgICAgICBjb25zdCBmaWxlVXBsb2FkUmVxdWVzdHMgPSB5aWVsZCogRWZmZWN0LmZvckVhY2goZmlsZXNXaXRoQ3VzdG9tSWRzLCAoZmlsZSk9PkVmZmVjdC5tYXAobWF0Y2hGaWxlVHlwZShmaWxlLCBvYmplY3RLZXlzKHBhcnNlZENvbmZpZykpLCAodHlwZSk9Pih7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUgfHwgdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBmaWxlLmxhc3RNb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tSWQ6IGZpbGUuY3VzdG9tSWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnREaXNwb3NpdGlvbjogcGFyc2VkQ29uZmlnW3R5cGVdPy5jb250ZW50RGlzcG9zaXRpb24gPz8gXCJpbmxpbmVcIixcbiAgICAgICAgICAgICAgICAgICAgYWNsOiBwYXJzZWRDb25maWdbdHlwZV0/LmFjbFxuICAgICAgICAgICAgICAgIH0pKSkucGlwZShFZmZlY3QuY2F0Y2hUYWdzKHtcbiAgICAgICAgICAgIC8qKiBTaG91bGRuJ3QgaGFwcGVuIHNpbmNlIGNvbmZpZyBpcyB2YWxpZGF0ZWQgYWJvdmUgc28ganVzdCBkeWluZyBpcyBmaW5lIEkgdGhpbmsgKi8gSW52YWxpZEZpbGVUeXBlOiAoZSk9PkVmZmVjdC5kaWUoZSksXG4gICAgICAgICAgICBVbmtub3duRmlsZVR5cGU6IChlKT0+RWZmZWN0LmRpZShlKVxuICAgICAgICB9KSk7XG4gICAgICAgIGNvbnN0IHJvdXRlT3B0aW9ucyA9IHVwbG9hZGFibGUucm91dGVPcHRpb25zO1xuICAgICAgICBjb25zdCB7IGFwaUtleSwgYXBwSWQgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgICAgICBjb25zdCBpbmdlc3RVcmwgPSB5aWVsZCogSW5nZXN0VXJsO1xuICAgICAgICBjb25zdCBpc0RldiA9IHlpZWxkKiBJc0RldmVsb3BtZW50O1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiR2VuZXJhdGluZyBwcmVzaWduZWQgVVJMc1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJmaWxlVXBsb2FkUmVxdWVzdHNcIiwgZmlsZVVwbG9hZFJlcXVlc3RzKSwgRWZmZWN0LmFubm90YXRlTG9ncyhcImluZ2VzdFVybFwiLCBpbmdlc3RVcmwpKTtcbiAgICAgICAgY29uc3QgcHJlc2lnbmVkVXJscyA9IHlpZWxkKiBFZmZlY3QuZm9yRWFjaChmaWxlVXBsb2FkUmVxdWVzdHMsIChmaWxlKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0geWllbGQqIGdlbmVyYXRlS2V5KGZpbGUsIGFwcElkLCByb3V0ZU9wdGlvbnMuZ2V0RmlsZUhhc2hQYXJ0cyk7XG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0geWllbGQqIGdlbmVyYXRlU2lnbmVkVVJMKGAke2luZ2VzdFVybH0vJHtrZXl9YCwgYXBpS2V5LCB7XG4gICAgICAgICAgICAgICAgICAgIHR0bEluU2Vjb25kczogcm91dGVPcHRpb25zLnByZXNpZ25lZFVSTFRUTCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWlkZW50aWZpZXJcIjogYXBwSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtZmlsZS1uYW1lXCI6IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11dC1maWxlLXNpemVcIjogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWZpbGUtdHlwZVwiOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtc2x1Z1wiOiBzbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWN1c3RvbS1pZFwiOiBmaWxlLmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWNvbnRlbnQtZGlzcG9zaXRpb25cIjogZmlsZS5jb250ZW50RGlzcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtYWNsXCI6IGZpbGUuYWNsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgICAgIGtleVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSwge1xuICAgICAgICAgICAgY29uY3VycmVuY3k6IFwidW5ib3VuZGVkXCJcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNlcnZlclJlcSA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5IdHRwU2VydmVyUmVxdWVzdDtcbiAgICAgICAgY29uc3QgcmVxdWVzdFVybCA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC50b1VSTChzZXJ2ZXJSZXEpO1xuICAgICAgICBjb25zdCBkZXZIb29rUmVxdWVzdCA9IHlpZWxkKiBDb25maWcuc3RyaW5nKFwiY2FsbGJhY2tVcmxcIikucGlwZShDb25maWcud2l0aERlZmF1bHQocmVxdWVzdFVybC5vcmlnaW4gKyByZXF1ZXN0VXJsLnBhdGhuYW1lKSwgRWZmZWN0Lm1hcCgodXJsKT0+SHR0cENsaWVudFJlcXVlc3QucG9zdCh1cmwpLnBpcGUoSHR0cENsaWVudFJlcXVlc3QuYXBwZW5kVXJsUGFyYW0oXCJzbHVnXCIsIHNsdWcpKSkpO1xuICAgICAgICBjb25zdCBtZXRhZGF0YVJlcXVlc3QgPSBIdHRwQ2xpZW50UmVxdWVzdC5wb3N0KFwiL3JvdXRlLW1ldGFkYXRhXCIpLnBpcGUoSHR0cENsaWVudFJlcXVlc3QucHJlcGVuZFVybChpbmdlc3RVcmwpLCBIdHRwQ2xpZW50UmVxdWVzdC5zZXRIZWFkZXJzKHtcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1hcGkta2V5XCI6IFJlZGFjdGVkLnZhbHVlKGFwaUtleSksXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiB2ZXJzaW9uLFxuICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWJlLWFkYXB0ZXJcIjogYmVBZGFwdGVyLFxuICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWZlLXBhY2thZ2VcIjogZmVQYWNrYWdlXG4gICAgICAgIH0pLCBIdHRwQ2xpZW50UmVxdWVzdC5ib2R5SnNvbih7XG4gICAgICAgICAgICBmaWxlS2V5czogcHJlc2lnbmVkVXJscy5tYXAoKHsga2V5IH0pPT5rZXkpLFxuICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhLFxuICAgICAgICAgICAgaXNEZXYsXG4gICAgICAgICAgICBjYWxsYmFja1VybDogZGV2SG9va1JlcXVlc3QudXJsLFxuICAgICAgICAgICAgY2FsbGJhY2tTbHVnOiBzbHVnLFxuICAgICAgICAgICAgYXdhaXRTZXJ2ZXJEYXRhOiByb3V0ZU9wdGlvbnMuYXdhaXRTZXJ2ZXJEYXRhID8/IHRydWVcbiAgICAgICAgfSksIEVmZmVjdC5mbGF0TWFwKGh0dHBDbGllbnQuZXhlY3V0ZSkpO1xuICAgICAgICAvLyBTZW5kIG1ldGFkYXRhIHRvIFVUIHNlcnZlciAobm9uIGJsb2NraW5nIGFzIGEgZGFlbW9uKVxuICAgICAgICAvLyBJbiBkZXYsIGtlZXAgdGhlIHN0cmVhbSBvcGVuIGFuZCBzaW11bGF0ZSB0aGUgY2FsbGJhY2sgcmVxdWVzdHMgYXNcbiAgICAgICAgLy8gZmlsZXMgY29tcGxldGUgdXBsb2FkaW5nXG4gICAgICAgIGNvbnN0IGZpYmVyID0geWllbGQqIEVmZmVjdC5pZihpc0Rldiwge1xuICAgICAgICAgICAgb25UcnVlOiAoKT0+bWV0YWRhdGFSZXF1ZXN0LnBpcGUoRWZmZWN0LnRhcEJvdGgoe1xuICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IGxvZ0h0dHBDbGllbnRSZXNwb25zZShcIlJlZ2lzdGVyZWQgbWV0YWRhdGFcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWl4aW46IFwiTm9uZVwiXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IGxvZ0h0dHBDbGllbnRFcnJvcihcIkZhaWxlZCB0byByZWdpc3RlciBtZXRhZGF0YVwiKVxuICAgICAgICAgICAgICAgIH0pLCBIdHRwQ2xpZW50UmVzcG9uc2Uuc3RyZWFtLCBoYW5kbGVKc29uTGluZVN0cmVhbShNZXRhZGF0YUZldGNoU3RyZWFtUGFydCwgKGNodW5rKT0+ZGV2SG9va1JlcXVlc3QucGlwZShIdHRwQ2xpZW50UmVxdWVzdC5zZXRIZWFkZXJzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXBsb2FkdGhpbmctaG9va1wiOiBjaHVuay5ob29rLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXNpZ25hdHVyZVwiOiBjaHVuay5zaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgICAgfSksIEh0dHBDbGllbnRSZXF1ZXN0LnNldEJvZHkoSHR0cEJvZHkudGV4dChjaHVuay5wYXlsb2FkLCBcImFwcGxpY2F0aW9uL2pzb25cIikpLCBodHRwQ2xpZW50LmV4ZWN1dGUsIEVmZmVjdC50YXBCb3RoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogbG9nSHR0cENsaWVudFJlc3BvbnNlKFwiU3VjY2Vzc2Z1bGx5IGZvcndhcmRlZCBjYWxsYmFjayByZXF1ZXN0IGZyb20gZGV2IHN0cmVhbVwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogbG9nSHR0cENsaWVudEVycm9yKFwiRmFpbGVkIHRvIGZvcndhcmQgY2FsbGJhY2sgcmVxdWVzdCBmcm9tIGRldiBzdHJlYW1cIilcbiAgICAgICAgICAgICAgICAgICAgfSksIEVmZmVjdC5hbm5vdGF0ZUxvZ3MoY2h1bmspLCBFZmZlY3QuYXNWb2lkLCBFZmZlY3QuaWdub3JlTG9nZ2VkLCBFZmZlY3Quc2NvcGVkKSkpLFxuICAgICAgICAgICAgb25GYWxzZTogKCk9Pm1ldGFkYXRhUmVxdWVzdC5waXBlKEVmZmVjdC50YXBCb3RoKHtcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBsb2dIdHRwQ2xpZW50UmVzcG9uc2UoXCJSZWdpc3RlcmVkIG1ldGFkYXRhXCIpLFxuICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IGxvZ0h0dHBDbGllbnRFcnJvcihcIkZhaWxlZCB0byByZWdpc3RlciBtZXRhZGF0YVwiKVxuICAgICAgICAgICAgICAgIH0pLCBFZmZlY3QuZmxhdE1hcChIdHRwQ2xpZW50UmVzcG9uc2Uuc2NoZW1hQm9keUpzb24oTWV0YWRhdGFGZXRjaFJlc3BvbnNlKSksIEVmZmVjdC5zY29wZWQpXG4gICAgICAgIH0pLnBpcGUoRWZmZWN0LmZvcmtEYWVtb24pO1xuICAgICAgICBjb25zdCBwcmVzaWduZWRzID0gcHJlc2lnbmVkVXJscy5tYXAoKHAsIGkpPT4oe1xuICAgICAgICAgICAgICAgIHVybDogcC51cmwsXG4gICAgICAgICAgICAgICAga2V5OiBwLmtleSxcbiAgICAgICAgICAgICAgICBuYW1lOiBmaWxlVXBsb2FkUmVxdWVzdHNbaV0ubmFtZSxcbiAgICAgICAgICAgICAgICBjdXN0b21JZDogZmlsZVVwbG9hZFJlcXVlc3RzW2ldLmN1c3RvbUlkID8/IG51bGxcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dJbmZvKFwiU2VuZGluZyBwcmVzaWduZWQgVVJMcyB0byBjbGllbnRcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwicHJlc2lnbmVkVXJsc1wiLCBwcmVzaWduZWRzKSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2R5OiBwcmVzaWduZWRzLFxuICAgICAgICAgICAgZmliZXJcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImhhbmRsZVVwbG9hZEFjdGlvblwiKSk7XG5cbmZ1bmN0aW9uIGludGVybmFsQ3JlYXRlQnVpbGRlcihpbml0RGVmID0ge30pIHtcbiAgICBjb25zdCBfZGVmID0ge1xuICAgICAgICAkdHlwZXM6IHt9LFxuICAgICAgICAvLyBEZWZhdWx0IHJvdXRlciBjb25maWdcbiAgICAgICAgcm91dGVyQ29uZmlnOiB7XG4gICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgIG1heEZpbGVTaXplOiBcIjRNQlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJvdXRlT3B0aW9uczoge1xuICAgICAgICAgICAgYXdhaXRTZXJ2ZXJEYXRhOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGlucHV0UGFyc2VyOiB7XG4gICAgICAgICAgICBwYXJzZUFzeW5jOiAoKT0+UHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCksXG4gICAgICAgICAgICBfaW5wdXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIF9vdXRwdXQ6IHVuZGVmaW5lZFxuICAgICAgICB9LFxuICAgICAgICBtaWRkbGV3YXJlOiAoKT0+KHt9KSxcbiAgICAgICAgb25VcGxvYWRFcnJvcjogKCk9PntcbiAgICAgICAgLy8gbm9vcFxuICAgICAgICB9LFxuICAgICAgICBvblVwbG9hZENvbXBsZXRlOiAoKT0+dW5kZWZpbmVkLFxuICAgICAgICBlcnJvckZvcm1hdHRlcjogaW5pdERlZi5lcnJvckZvcm1hdHRlciA/PyBkZWZhdWx0RXJyb3JGb3JtYXR0ZXIsXG4gICAgICAgIC8vIE92ZXJsb2FkIHdpdGggcHJvcGVydGllcyBwYXNzZWQgaW5cbiAgICAgICAgLi4uaW5pdERlZlxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5wdXQgKHVzZXJQYXJzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIC4uLl9kZWYsXG4gICAgICAgICAgICAgICAgaW5wdXRQYXJzZXI6IHVzZXJQYXJzZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBtaWRkbGV3YXJlICh1c2VyTWlkZGxld2FyZSkge1xuICAgICAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICAgICAgLi4uX2RlZixcbiAgICAgICAgICAgICAgICBtaWRkbGV3YXJlOiB1c2VyTWlkZGxld2FyZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uVXBsb2FkQ29tcGxldGUgKHVzZXJVcGxvYWRDb21wbGV0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5fZGVmLFxuICAgICAgICAgICAgICAgIG9uVXBsb2FkQ29tcGxldGU6IHVzZXJVcGxvYWRDb21wbGV0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGxvYWRFcnJvciAodXNlck9uVXBsb2FkRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIC4uLl9kZWYsXG4gICAgICAgICAgICAgICAgb25VcGxvYWRFcnJvcjogdXNlck9uVXBsb2FkRXJyb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUJ1aWxkZXIob3B0cykge1xuICAgIHJldHVybiAoaW5wdXQsIGNvbmZpZyk9PntcbiAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICByb3V0ZXJDb25maWc6IGlucHV0LFxuICAgICAgICAgICAgcm91dGVPcHRpb25zOiBjb25maWcgPz8ge30sXG4gICAgICAgICAgICAuLi5vcHRzXG4gICAgICAgIH0pO1xuICAgIH07XG59XG5cbmNvbnN0IGNyZWF0ZVVwbG9hZHRoaW5nID0gKG9wdHMpPT5jcmVhdGVCdWlsZGVyKG9wdHMpO1xuY29uc3QgY3JlYXRlUm91dGVIYW5kbGVyID0gKG9wdHMpPT57XG4gICAgY29uc3QgaGFuZGxlciA9IG1ha2VBZGFwdGVySGFuZGxlcigocmVxKT0+RWZmZWN0LnN1Y2NlZWQoe1xuICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgcmVzOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBldmVudDogdW5kZWZpbmVkXG4gICAgICAgIH0pLCAocmVxKT0+RWZmZWN0LnN1Y2NlZWQocmVxKSwgb3B0cywgXCJuZXh0anMtYXBwXCIpO1xuICAgIHJldHVybiB7XG4gICAgICAgIFBPU1Q6IGhhbmRsZXIsXG4gICAgICAgIEdFVDogaGFuZGxlclxuICAgIH07XG59O1xuXG5leHBvcnQgeyBjcmVhdGVSb3V0ZUhhbmRsZXIsIGNyZWF0ZVVwbG9hZHRoaW5nIH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/next/index.js\n");

/***/ })

};
;